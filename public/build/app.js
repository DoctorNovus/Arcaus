!function(){"use strict";class t{set(t){this.prototype=Object.assign(this,t)}static create(e){return new Proxy(new t,{set:(t,i,a)=>"prototype"==i||t[i]==a||(t[i]?(t[i]=a,e&&e(i,a),!0):(t[i]=a,!0))})}}const e=async function(t,e){const i=await fetch(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}});return{headers:i.headers,statusCode:i.status,responseType:i.type,responseUrl:i.url,data:await i.json()}};class i{constructor(){this.playing=[]}play(t){let e=i.context.createBufferSource();e.buffer=t.buffer,e.connect(t.gainNode),e.loop=t.looping,t.node=e,t.node.start(0),this.playing.push(t)}stop(t){this.playing.includes(t)&&(t.node.stop(0),this.playing.splice(this.playing.indexOf(t),1))}pause(t){this.playing.includes(t)&&(t.node.disconnect(t.gainNode),this.playing.splice(this.playing.indexOf(t),1))}resume(t){this.playing.includes(t)||(t.node.connect(t.gainNode),this.playing.push(t))}isPlaying(t){return this.playing.includes(t)}static unlock(){try{let t=window.AudioContext||window.webkitAudioContext;if(i.context=new t,"suspended"==i.context.state){let t=function(){i.context.resume().then((function(){document.body.removeEventListener("touchstart",t),document.body.removeEventListener("touchend",t),document.body.removeEventListener("click",t)}))};document.body.addEventListener("touchstart",t),document.body.addEventListener("touchend",t),document.body.addEventListener("click",t)}}catch(t){console.log("WebAudio API is not supported!")}}}i.context=null;class a{constructor(t,e=gl.STATIC_DRAW){this.type=t,this.mode=e,this.buffer=gl.createBuffer()}bind(){gl.bindBuffer(this.type,this.buffer)}data(t){gl.bufferData(this.type,t,this.mode)}subData(t,e=0){gl.bufferSubData(this.type,e,t)}unbind(){gl.bindBuffer(this.type,null)}delete(){gl.deleteBuffer(this.buffer)}}class s extends a{constructor(t=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,t),super.bind(),super.data(new Float32Array([.5,.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(0),gl.vertexAttribPointer(0,3,gl.FLOAT,!1,0,0)}disable(){super.unbind(),gl.disableVertexAttribArray(0)}}class r{constructor(t=window.innerWidth,e=window.innerHeight){this.canvas=document.createElement("canvas"),this.canvas.id="SkylarkDisplay",this.canvas.width=t,this.canvas.height=e,this.options={alpha:!1},this.then=0,this.tolerance=.1}create(){if(window.gl=this.canvas.getContext("webgl",this.options),!gl)throw new Error("WebGL is not supported!");document.body.appendChild(this.canvas),gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),class{static init(){(new s).enable(),i.unlock()}}.init()}set(t){this.options=Object.assign(this.options,t)}resize(t=window.innerWidth,e=window.innerHeight){this.canvas.width=t,this.canvas.height=e,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight)}clear(t=0,e=0,i=0){gl.clear(gl.COLOR_BUFFER_BIT),gl.clearColor(t,e,i,1)}get width(){return this.canvas.width}get height(){return this.canvas.height}}class n{constructor(){this.data=new Float32Array(16),this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1}copy(t){this.data=t.data}identity(){this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=1,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=1,this.data[11]=0,this.data[12]=0,this.data[13]=0,this.data[14]=0,this.data[15]=1}translate(t,e,i){this.data[12]=this.data[0]*t+this.data[4]*e+this.data[8]*i+this.data[12],this.data[13]=this.data[1]*t+this.data[5]*e+this.data[9]*i+this.data[13],this.data[14]=this.data[2]*t+this.data[6]*e+this.data[10]*i+this.data[14],this.data[15]=this.data[3]*t+this.data[7]*e+this.data[11]*i+this.data[15]}rotateX(t){let e=Math.sin(t),i=Math.cos(t);this.data[4]*=i+this.data[8]*e,this.data[5]*=i+this.data[9]*e,this.data[6]*=i+this.data[10]*e,this.data[7]*=i+this.data[11]*e,this.data[8]*=i-this.data[4]*e,this.data[9]*=i-this.data[5]*e,this.data[10]*=i-this.data[6]*e,this.data[11]*=i-this.data[7]*e}rotateY(t){let e=Math.sin(t),i=Math.cos(t);this.data[0]*=i-this.data[8]*e,this.data[1]*=i-this.data[9]*e,this.data[2]*=i-this.data[10]*e,this.data[3]*=i-this.data[11]*e,this.data[8]=this.data[0]*e+this.data[8]*i,this.data[9]=this.data[1]*e+this.data[9]*i,this.data[10]=this.data[2]*e+this.data[10]*i,this.data[11]=this.data[3]*e+this.data[11]*i}rotateZ(t){let e=Math.sin(t),i=Math.cos(t);this.data[0]*=i+this.data[4]*e,this.data[1]*=i+this.data[5]*e,this.data[2]*=i+this.data[6]*e,this.data[3]*=i+this.data[7]*e,this.data[4]*=i-this.data[0]*e,this.data[5]*=i-this.data[1]*e,this.data[6]*=i-this.data[2]*e,this.data[7]*=i-this.data[3]*e}scale(t,e,i){this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this.data[4]*=e,this.data[5]*=e,this.data[6]*=e,this.data[7]*=e,this.data[8]*=i,this.data[9]*=i,this.data[10]*=i,this.data[11]*=i}orthographic(t,e,i,a,s,r){let n=1/(t-e),o=1/(i-a),h=1/(s-r);this.data[0]=-2*n,this.data[5]=-2*o,this.data[10]=2*h,this.data[12]=(t+e)*n,this.data[13]=(a+i)*o,this.data[14]=(r+s)*h}lookAt(t,e,i){Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6&&Math.abs(t.z-e.z)<1e-6&&this.identity();let a=t.x-e.x,s=t.y-e.y,r=t.z-e.z,n=1/Math.hypot(a,s,r);a*=n,s*=n,r*=n;let o=i.y*r-i.z*s,h=i.z*a-i.x*r,d=i.x*s-i.y*a;n=Math.hypot(o,h,d),n?(n=1/n,o*=n,h*=n,d*=n):(o=0,h=0,d=0);let l=s*d-r*h,c=r*o-a*d,g=a*h-s*o;n=Math.hypot(l,c,g),n?(n=1/n,l*=n,c*=n,g*=n):(l=0,c=0,g=0),this.data[0]=o,this.data[1]=l,this.data[2]=a,this.data[4]=h,this.data[5]=c,this.data[6]=s,this.data[8]=d,this.data[9]=g,this.data[10]=r,this.data[12]=-(o*t.x+h*t.y+d*t.z),this.data[13]=-(l*t.x+c*t.y+g*t.z),this.data[14]=-(a*t.x+s*t.y+r*t.z)}static invert(t){let e=t.data,i=new n,a=e[0],s=e[1],r=e[2],o=e[3],h=e[4],d=e[5],l=e[6],c=e[7],g=e[8],u=e[9],m=e[10],p=e[11],w=e[12],y=e[13],f=e[14],E=e[15],T=a*d-s*h,_=a*l-r*h,x=a*c-o*h,b=s*l-r*d,A=s*c-o*d,R=r*c-o*l,v=g*y-u*w,L=g*f-m*w,P=g*E-p*w,S=u*f-m*y,I=u*E-p*y,F=m*E-p*f,D=T*F-_*I+x*S+b*P-A*L+R*v;return D?(D=1/D,i.data[0]=(d*F-l*I+c*S)*D,i.data[1]=(r*I-s*F-o*S)*D,i.data[2]=(y*R-f*A+E*b)*D,i.data[3]=(m*A-u*R-p*b)*D,i.data[4]=(l*P-h*F-c*L)*D,i.data[5]=(a*F-r*P+o*L)*D,i.data[6]=(f*x-w*R-E*_)*D,i.data[7]=(g*R-m*x+p*_)*D,i.data[8]=(h*I-d*P+c*v)*D,i.data[9]=(s*P-a*I-o*v)*D,i.data[10]=(w*A-y*x+E*T)*D,i.data[11]=(u*x-g*A-p*T)*D,i.data[12]=(d*L-h*S-l*v)*D,i.data[13]=(a*S-s*L+r*v)*D,i.data[14]=(y*_-w*b-f*T)*D,i.data[15]=(g*b-u*_+m*T)*D,i):null}static multiply(t,e){let i=t.data,a=e.data,s=new n,r=i[0],o=i[1],h=i[2],d=i[3],l=i[4],c=i[5],g=i[6],u=i[7],m=i[8],p=i[9],w=i[10],y=i[11],f=i[12],E=i[13],T=i[14],_=i[15],x=a[0],b=a[1],A=a[2],R=a[3];return s.data[0]=x*r+b*l+A*m+R*f,s.data[1]=x*o+b*c+A*p+R*E,s.data[2]=x*h+b*g+A*w+R*T,s.data[3]=x*d+b*u+A*y+R*_,x=a[4],b=a[5],A=a[6],R=a[7],s.data[4]=x*r+b*l+A*m+R*f,s.data[5]=x*o+b*c+A*p+R*E,s.data[6]=x*h+b*g+A*w+R*T,s.data[7]=x*d+b*u+A*y+R*_,x=a[8],b=a[9],A=a[10],R=a[11],s.data[8]=x*r+b*l+A*m+R*f,s.data[9]=x*o+b*c+A*p+R*E,s.data[10]=x*h+b*g+A*w+R*T,s.data[11]=x*d+b*u+A*y+R*_,x=a[12],b=a[13],A=a[14],R=a[15],s.data[12]=x*r+b*l+A*m+R*f,s.data[13]=x*o+b*c+A*p+R*E,s.data[14]=x*h+b*g+A*w+R*T,s.data[15]=x*d+b*u+A*y+R*_,s}}class o{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}transformMat4(t){let e=this.x,i=this.y;this.x=t.data[0]*e+t.data[4]*i+t.data[12],this.y=t.data[1]*e+t.data[5]*i+t.data[13]}}class h{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){this.x=t,this.y=e,this.z=i}}class d{constructor(t=gl.canvas.width,e=gl.canvas.height,i=!0){this.width=t,this.height=e,this.position=new o(0,0),this.viewMatrix=new n,this.projectionMatrix=new n,this.combined=new n,i?this.projectionMatrix.orthographic(-this.width/2,this.width/2,-this.height/2,this.height/2,-1,1e3):this.projectionMatrix.orthographic(0,this.width,0,this.height,-1,1e3),this.update()}update(){this.viewMatrix.lookAt(new h(this.position.x,this.position.y,10),new h(this.position.x,this.position.y,0),new h(0,1,0)),this.combined=n.multiply(this.projectionMatrix,this.viewMatrix)}setPosition(t,e){this.position.set(t,e)}inView(t,e){return t>=this.position.x&&t<=this.position.x+this.width&&e>=this.position.y&&e<=this.position.y+this.height}unproject(t,e){let i=n.invert(this.combined),a=new o(2*t/gl.canvas.width-1,-2*e/gl.canvas.height+1);return a.transformMat4(i),a}}class l{constructor(){this.program=gl.createProgram()}compile(t,e){let i=this.loadShader(t,gl.VERTEX_SHADER),a=this.loadShader(e,gl.FRAGMENT_SHADER);if(gl.attachShader(this.program,i),gl.attachShader(this.program,a),this.bindAttributes(),gl.linkProgram(this.program),gl.validateProgram(this.program),!gl.getProgramParameter(this.program,gl.LINK_STATUS)){let t=gl.getProgramInfoLog(this.program);throw gl.deleteProgram(this.program),gl.deleteShader(i),gl.delteteShader(a),new Error(`SHADER_PROGRAM: ${t}`)}}start(){gl.useProgram(this.program)}stop(){gl.useProgram(null)}bindAttribute(t,e){gl.bindAttribLocation(this.program,t,e)}bindAttributes(){this.bindAttribute(0,"a_position"),this.bindAttribute(1,"a_texCoords")}getAttributeLocation(t){return gl.getAttribLocation(this.program,t)}getUniformLocation(t){return gl.getUniformLocation(this.program,t)}extractUniforms(){let t={},e=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);for(let i=0;i<e;i++){let e=gl.getActiveUniform(this.program,i),a=e.name.replace("[0]",""),s=this.getUniformLocation(a);t[a]={name:a,location:s,type:e.type}}return t}loadFloat(t,e){gl.uniform1f(t,e)}loadVector2(t,e){gl.uniform2f(t,e.x,e.y)}loadVector3(t,e){gl.uniform3f(t,e.x,e.y,e.z)}loadMatrix4(t,e){gl.uniformMatrix4fv(t,!1,e.data)}loadShader(t,e){let i=gl.createShader(e);if(gl.shaderSource(i,t),gl.compileShader(i),!gl.getShaderParameter(i,gl.COMPILE_STATUS)){let t;e==gl.VERTEX_SHADER?t="VERTEX_SHADER":e==gl.FRAGMENT_SHADER&&(t="FRAGMENT_SHADER");let a=gl.getShaderInfoLog(i);throw gl.deleteShader(i),new Error(`${t}: ${a}`)}return i}}class c{constructor(t,e){this.id=Math.random(),this.shader=new l,this.shader.compile(t,e),this.uniforms=this.shader.extractUniforms()}use(){c.currentID!=this.id&&(c.currentID=this.id,this.shader.start()),this.prepare()}prepare(){}set(t,e){let i=this.uniforms[t];switch(i.type){case gl.FLOAT:this.shader.loadFloat(i.location,e);break;case gl.FLOAT_VEC2:this.shader.loadVector2(i.location,e);break;case gl.FLOAT_VEC3:this.shader.loadVector3(i.location,e);break;case gl.FLOAT_MAT4:this.shader.loadMatrix4(i.location,e);break;default:throw new Error(`${e} is not a compatible value type!`)}}}c.currentID=0;class g extends a{constructor(t=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,t),super.bind(),super.data(new Float32Array([1,1,0,1,1,0,0,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(1),gl.vertexAttribPointer(1,2,gl.FLOAT,!1,0,0)}disable(){gl.disableVertexAttribArray(1),super.unbind()}}class u extends c{constructor(t){super("\n    attribute vec3 a_position;\n    attribute vec2 a_texCoords;\n\n    varying vec2 v_texCoords;\n\n    uniform mat4 u_model;\n    uniform mat4 u_viewProjection;\n\n    void main(void) {\n        gl_Position = u_viewProjection * u_model * vec4(a_position, 1.0);\n        v_texCoords = a_texCoords;\n    }\n","\n    precision mediump float;\n\n    varying vec2 v_texCoords;\n\n    uniform sampler2D u_image;\n    uniform vec3 u_color;\n\n    void main(void) {\n        \n        gl_FragColor = texture2D(u_image, v_texCoords) * vec4(u_color, 1.0);\n    }\n"),this.image=t,this.textureID=t.textureID,this.tint=new h(1,1,1),this.region=[1,1,0,1,1,0,0,0],this.regionX=0,this.regionY=0,this.regionWidth=this.image.naturalWidth,this.regionHeight=this.image.naturalHeight,this.textureBuffer=new g(gl.DYNAMIC_DRAW)}prepare(){this.textureBuffer.enable(),gl.bindTexture(gl.TEXTURE_2D,this.textureID),super.set("u_color",this.tint)}setTint(t,e,i){this.tint.set(t/255,e/255,i/255)}setRegion(t,e,i,a){let s={};s.left=t/this.image.naturalWidth,s.right=(t+i)/this.image.naturalWidth,s.bottom=e/this.image.naturalHeight,s.top=(e+a)/this.image.naturalHeight,this.region=[s.right,s.top,s.left,s.top,s.right,s.bottom,s.left,s.bottom],this.regionX=t,this.regionY=e,this.regionWidth=i,this.regionHeight=a,this.textureBuffer.bind(),this.textureBuffer.subData(new Float32Array(this.region))}setRegionUV(t,e,i,a){this.region=[e,a,t,a,e,i,t,i]}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}}class m extends u{constructor(t){super(t),this.animationType=0,this.updateInterval=1,this.currentAdvance=1,this.currentFrame=0,this.currentTick=0}prepare(){super.prepare(),this.update()}setSequence(t,e,i,a,s,r=0){this.frameX=t,this.frameY=e,this.frameWidth=i,this.frameHeight=a,this.widthPadding=r,this.frameCount=s,this.updateFrame()}setSpeed(t){this.updateInterval=t}update(){this.currentTick++,this.currentTick>=this.updateInterval&&(this.currentTick=0,this.currentFrame+=this.currentAdvance,this.currentFrame>=0&&this.currentFrame<this.frameCount?this.updateFrame():(this.currentTick=0,this.currentFrame=0))}updateFrame(){let t=this.frameX+this.currentFrame*(this.frameWidth+this.widthPadding);super.setRegion(t,this.frameY,this.frameWidth,this.frameHeight)}}class p{constructor(){this.origin=new o(0,0),this.position=new o(0,0),this.scale=new o(1,1),this.rotationInRadians=0,this.matrix=new n}setRotation(t){for(this.rotationInRadians=t;this.rotationInRadians>2*Math.PI;)this.rotationInRadians-=2*Math.PI}update(){this.matrix.identity(),this.matrix.translate(this.x+this.origin.x,this.y+this.origin.y,0),this.matrix.rotateZ(this.rotationInRadians),this.matrix.scale(this.width,this.height,1)}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}get width(){return this.scale.x}set width(t){this.scale.x=t}get height(){return this.scale.y}set height(t){this.scale.y=t}}Object.freeze({LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",SPACE:" ",TAB:"Tab",SHIFT:"Shift",BACKQUOTE:"`",ESCAPE:"Escape",CONTROL:"Control",META:"meta",BACKSPACE:"Backspace",ENTER:"Enter",SLASH:"/",ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z"}),Object.freeze({LEFT:0,MIDDLE:1,RIGHT:2});class w{static load(t="string",e="Object"){throw new Error(`[Unimplemented Function]: LoaderInterface.load(${t}, ${e})`)}static unload(t,e){delete e[t]}static isLoaded(t,e){return t in e}}class y extends w{static load(t,e){if(super.isLoaded(t,e))return;let i=new Image;return new Promise((function(a,s){i.addEventListener("load",(function(){let s=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,i),gl.bindTexture(gl.TEXTURE_2D,null),i.textureID=s,e[t]=i,a()})),i.addEventListener("error",(function(){s(new Error(`Failed to load asset: ${t}`))})),i.src=t}))}static unload(t,e){gl.deleteTexture(e[t].textureID),super.unload(t,e)}}class f extends w{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(i,a){fetch(t).then(t=>t.json()).then(a=>{e[t]=a,i()}).catch(()=>{a(new Error(`Failed to load asset: ${t}`))})}))}}class E extends w{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(i,a){fetch(t).then(t=>t.text()).then(a=>{e[t]=a,i()}).catch(()=>{a(new Error(`Failed to load asset: ${t}`))})}))}}class T extends w{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(a,s){fetch(t).then(t=>t.arrayBuffer()).then(s=>{i.context.decodeAudioData(s,(function(i){e[t]=i,a()}))}).catch(()=>{s(new Error(`Failed to load asset: ${t}`))})}))}}class _ extends w{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(i,a){fetch(t).then(t=>t.json()).then(s=>{_.loadTilesets(s,e,t,i,a)}).catch(()=>{a(new Error(`Failed to load asset: ${t}`))})}))}static unload(t,e){let i=e[t].data.tilesets;for(let t=0;t<i.length;t++)gl.deleteTexture(e[i[t].image].textureID);super.unload(t,e)}static loadTilesets(t,e,i,a,s){let r=t.tilesets.length,n=0;for(let o=0;o<r;o++){let h=new Image;h.addEventListener("load",(function(){e[t.tilesets[o].image]=h,n++,n==r&&_.splitTiles(t,e,i,a,s)})),h.addEventListener("error",(function(){s(new Error(`Failed to load asset: ${i}`))})),h.src=t.tilesets[o].image}}static splitTiles(t,e,i,a,s){let r=[],n=t.tilesets.length;for(let i=0;i<n;i++)r.push(e[t.tilesets[i].image]);let o=[];for(let e=0;e<r.length;e++){let i=r[e].width/t.tilewidth,a=r[e].height/t.tileheight;for(let s=0;s<a;s++)for(let a=0;a<i;a++){let i=document.createElement("canvas"),n=i.getContext("2d");n.width=t.tilewidth,n.height=t.tileheight;let h=a*t.tilewidth,d=s*t.tileheight;n.drawImage(r[e],-h,-d),o.push(i)}}_.predraw(t,e,i,r,o,a,s)}static predraw(t,e,i,a,s,r,n){let o=document.createElement("canvas");o.width=t.width*t.tilewidth,o.height=t.height*t.tileheight;let h=o.getContext("2d");for(let e=0;e<t.layers.length;e++){let i=0,a=0;if("tilelayer"==t.layers[e].type)for(let r=0;r<t.layers[e].data.length;r++){if(r%t.width==0&&0!=r&&(a+=t.tileheight,i=0),0!=t.layers[e].data[r]){let n=s[t.layers[e].data[r]];h.drawImage(n,i,a)}i+=t.tilewidth}}let d=new Image;d.addEventListener("load",(function(){let s=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,d),gl.bindTexture(gl.TEXTURE_2D,null),d.textureID=s,e[i]={data:t,tilesets:a,image:d},r()})),d.addEventListener("error",(function(){n(new Error(`Failed to load asset: ${i}`))})),d.src=o.toDataURL("image/png")}}class x{constructor(){this.queue=[],this.cache={},this.loaderTypes={png:y,jpg:y,jpeg:y,json:f,tiled:_,glsl:E,vert:E,frag:E,mp3:T,wav:T,ogg:T}}get(t){return this.cache[t]}add(t,e){if(Array.isArray(t))for(let i of t)this.queue.push(this.getLoadFunction(i,e));else this.queue.push(this.getLoadFunction(t,e))}load(t,e){if(Array.isArray(t)){let i=[];for(let a of t)i.push(this.getLoaderFunction(a,e));return Promise.all(i)}return this.getLoadFunction(t,e)}loadAssets(){return Promise.all(this.queue)}unload(t,e){this.loaderTypes[this.getType(t,e)].unload(t,this.cache)}empty(){this.queue=[]}clear(){this.queue=[];for(let t of Object.keys(this.cache))this.loaderTypes[this.getType(t)].unload(t,this.cache)}registerType(t,e){this.loaderTypes[t]?console.error(`${t} already a registed asset type!`):this.loaderTypes[t]=e}getLoadFunction(t,e){let i=this.getType(t,e);if(this.loaderTypes.hasOwnProperty(i))return this.loaderTypes[i].load(t,this.cache);throw new Error(`Unknown asset type: ${i}`)}getType(t,e){if(e)return e;{let e=t.split(".");return e[e.length-1]}}}Object.freeze({TEXTURE:"png",JSON:"json",SHADER:"glsl",AUDIO:"mp3",TILEDMAP:"tiled"});class b{constructor(t,e,i,a){this.x=t,this.y=e,this.width=i,this.height=a,this.right=this.x+this.width,this.bottom=this.y+this.height}setPosition(t,e){this.x=t,this.y=e}setSize(t,e){this.width=t,this.height=e}overlaps(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}within(t){return t.x>=this.x&&t.right<=this.right&&t.y<=this.y&&t.bottom>=this.bottom}contains(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom}}class A{constructor(){this.active=!1,this.FPS=60,this.MPF=1e3/this.FPS,this.lastTime=0,this.lagTime=0,this.currentTime=0,this.elapsedTime=0}async create(){}render(){}update(){}dispose(){}static async setScreen(t){null!=A.currentScreen&&(A.currentScreen.active=!1),A.currentScreen=t,t.previousTime=performance.now(),t.active=!0,await t.create(),requestAnimationFrame(t.renderLoop.bind(t))}renderGUI(t){try{document.getElementById("skylark-gui").innerHTML=t}catch{throw new Error('Element with id: "skylark-gui" not found!')}}renderLoop(){if(this.active){for(requestAnimationFrame(this.renderLoop.bind(this)),this.currentTime=performance.now(),this.elapsedTime=this.currentTime-this.lastTime,this.lastTime=this.currentTime,this.lagTime+=this.elapsedTime;this.lagTime>=this.MPF&&this.active;)this.update(),this.lagTime-=this.MPF;this.render()}else this.dispose()}}A.currentScreen=null;class R{static on(t,e){R.events[t]=e,window.addEventListener(t,e)}static remove(t,e){delete R.events[t],window.removeEventListener(t,e)}static emit(t){R.events[t]()}static isPortrait(){return window.innerHeight>window.innerWidth}static isLandscape(){return window.innerWidth>window.innerHeight}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static toggleFullscreen(){document.fullscreenEnabled&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen())}static togglePointerLock(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.body.requestPointerLock()}}R.events={};class v extends class{constructor(t){this.material=t,this.transform=new p,this.setPosition(0,0),this.setSize(100,100)}draw(t){this.material.use(),this.transform.update(),this.material.set("u_model",this.transform.matrix),this.material.set("u_viewProjection",t.combined),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}setMaterial(t){this.materia=t}setOrigin(t,e){this.transform.origin.set(t,e)}setPosition(t,e){this.transform.position.set(t,e)}setSize(t,e){this.transform.scale.set(t,e)}setRotation(t){this.transform.setRotation(t)}}{constructor(t,e,i,a,s){super(s),this.x=t,this.y=e,this.rect=new b(t,e,i,a),this.width=i,this.height=a}setAnimation(t){super.setMaterial(t)}move(t,e){this.x=t,this.y=e,super.setPosition(t,e)}}let L,P,S;window.game={animations:{},assets:{},players:[]};let I=new class{constructor(t){this._routes=t,this._parsedRoutes=this._parseRoutes(),this._useHashRouting=!1}on(t,e){this._routes[t]=e,this._parsedRoutes=this._parseRoutes()}setRouteNotFound(t){this._routes.ERROR_404=t}navigate(t){window.history.pushState({},t,window.location.origin+t),this._matchUrlToRoute(t)}listen(t=!1){this._useHashRouting=t,this._useHashRouting?window.addEventListener("hashchange",()=>{this._matchUrlToRoute(this._getCurrentUrl())}):window.addEventListener("popstate",()=>{this._matchUrlToRoute(this._getCurrentUrl())}),this._matchUrlToRoute(this._getCurrentUrl())}async _renderView(t,e={}){t._params=e,await t.load(e),t._element.innerHTML=await t.render(e),await t.didLoad(e)}_getCurrentUrl(){const t=(this._useHashRouting?window.location.hash.slice(1)||"/":window.location.pathname||"/").toLowerCase();return t.endsWith("/")&&t.length>1?t.slice(0,-1):t}_parseRoutes(){return Object.keys(this._routes).sort((t,e)=>e.length-t.length).map(t=>({url:new RegExp("^"+t.replace(/:[^\s/]+/g,"([\\w-]+)")+"$"),view:this._routes[t],routepath:t}))}_getUrlParameters(t,e){const i={},a=t.routepath.split("/");let s=1;for(let t of a)t.startsWith(":")&&(i[t.substring(1)]=e[s],s++);return i}_matchUrlToRoute(t){let e=null;for(let i of this._parsedRoutes)if(e=t.match(i.url),e){const t=this._getUrlParameters(i,e);return void this._renderView(this._routes[i.routepath],t)}if(!e){const e=this._routes.ERROR_404;if(!e)return void document.write(`Error 404: ${t} not found!`);this._renderView(e)}}}({"/":new class extends class{constructor(e="app"){this._element=document.getElementById(e),this._params={},this.state=t.create(()=>{this._element.innerHTML=this.render(this._params),this.didLoad(this._params)})}addStyle(t){const e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}setElement(t){this._element=t}setElementById(t){this._element=document.getElementById(t)}load(){}render(){}didLoad(){}static async render(t,e={}){t._params=e,await t.load(e),t._element.innerHTML=await t.render(e),await t.didLoad(e)}}{load(){super.addStyle("\n            html,\n            body{\n                overflow: hidden;\n                width: 100%;\n                height: 100%;\n                background-color: black;\n            }\n\n            form{\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                margin: auto;\n                height: 50%;\n                position: absolute;\n                top: 45%;\n                left: 25%;\n                color: white;\n            }\n\n            form *{\n                background-color: transparent;\n                height: 10%;\n                color: white;\n            }\n\n            #status{\n                width: 100%;\n                height: auto;\n            }\n\n            #background{\n                width: 100%;\n                height: 10%;\n                margin: auto;\n            }\n        ")}render(){return'\n            <img src="assets/logo.png" id="background">\n            <form id="login">\n                <input id="email" placeholder="Email" />\n                <input id="password" type="password" placeholder="Password" />\n                <button type="submit">Connect</button>\n                <h2 id="status"></h2>\n            </form>\n        '}didLoad(){document.getElementById("login").onsubmit=t=>{t.preventDefault(),e("/login",{email:document.getElementById("email").value,password:document.getElementById("password").value}).then(t=>{201==t.statusCode?(L=new WebSocket(t.data.socket),L.onopen=()=>{D({type:"connect",email:document.getElementById("email").value,password:document.getElementById("password").value}),P=document.getElementById("email").value},L.onmessage=t=>{switch((t=JSON.parse(t.data)).type){case"status":document.getElementById("status").innerText=t.message,t.login&&setTimeout(()=>{document.getElementById("app").innerHTML="",A.setScreen(new F)});break;case"setPlayers":game.players=[];for(let e in t.players){let i=t.players[e],a=new v(i.x,i.y,32,32,game.animations.base_idle_right);a.id=i.id,game.players.push(a)}break;case"updatePlayer":game.players.find(e=>e.id==t.player.id).move(t.player.x,t.player.y);break;case"setID":S=t.id}},L.onerror=t=>{t&&console.log(t)},L.onclose=()=>{I.navigate("/"),window.location.reload()}):document.getElementById("status").innerText=t.data.reason})}}}});I.listen();class F extends A{constructor(){super()}async create(){game.display=new r(window.innerWidth,window.innerHeight),game.display.create(),game.loader=new x,game.camera=new d(window.innerWidth,window.innerHeight),R.on("resize",()=>{game.display.resize(window.innerWidth,window.innerHeight)}),game.loader.add("assets/Base_Sprite_Walk.png"),await game.loader.loadAssets(),game.assets.base_walk=game.loader.get("assets/Base_Sprite_Walk.png"),game.animations.base_idle_right=new m(game.assets.base_walk),game.animations.base_idle_right.setSequence(144,0,48,48,1),game.animations.base_walk_right=new m(game.assets.base_walk),game.animations.base_walk_right.setSequence(0,0,48,48,3),game.animations.base_walk_right.setSpeed(10),game.animations.base_walk_left=new m(game.assets.base_walk),game.animations.base_walk_left.setSequence(192,0,48,48,3),D({type:"loadPlayers"})}update(){}render(){game.display.clear();for(let t=0;t<game.players.length;t++)game.players[t].draw(game.camera)}dispose(){}}function D(t){L.send(JSON.stringify(t))}window.onkeydown=t=>{let e=game.players.find(t=>t.id==S);switch(t.key){case"w":break;case"a":D({type:"move",pos:{x:e.x-5,y:e.y}});break;case"s":break;case"d":D({type:"move",pos:{x:e.x+5,y:e.y}})}}}();