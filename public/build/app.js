!function(){"use strict";class t{set(t){this.prototype=Object.assign(this,t)}static create(e){return new Proxy(new t,{set:(t,a,i)=>"prototype"==a||t[a]==i||(null!=t[a]?(t[a]=i,e(a,i),!0):(t[a]=i,!0))})}}class e{static compile(t){const a=document.createElement("div");a.innerHTML=t.render().replace(/\s+/g," "),e._walk(a,t._container)}static bindEvents(t){const e=t._container.querySelectorAll("*");for(let a of e)for(let e of a.attributes)if(e.localName.startsWith("@")){const i=e.localName.slice(1);a.addEventListener(i,t[e.value].bind(t))}}static unbindEvents(t){const e=t._container.querySelectorAll("*");for(let a of e)for(let e of a.attributes)if(e.localName.startsWith("@")){const i=e.localName.slice(1);a.removeEventListener(i,t[e.value].bind(t))}}static _walk(t,a){return t.isEqualNode(a)||(e._diff(t,a),e._updateChildren(t,a)),a}static _updateChildren(t,a){let i=0;for(let s=0;;s++){const r=a.childNodes[s],n=t.childNodes[s-i];if(!r&&!n)break;if(n)if(r)if(n.isEqualNode(r)){const t=e._walk(n,r);t!==r&&(a.replaceChild(t,r),i++)}else{let t=null;for(let e=s;e<a.childNodes.length;e++)if(a.childNodes[e].isEqualNode(n)){t=a.childNodes[e];break}if(t){const s=e._walk(n,t);s!=t&&i++,a.insertBefore(s,r)}else if(n.id||r.id)a.insertBefore(n,r),i++;else{const t=e._walk(n,r);t!=r&&(a.replaceChild(t,r),i++)}}else a.appendChild(n),i++;else a.removeChild(r),s--}}static _diff(t,a){t.nodeType==Node.ELEMENT_NODE?e._updateAttributes(t,a):a.nodeValue!=t.nodeValue&&(a.nodeValue=t.nodeValue),"INPUT"==t.nodeName?e._updateInput(t,a):"OPTION"==t.nodeName?e._updateAttribute(t,a,"selected"):"TEXTAREA"==t.nodeName&&e._updateTextArea(t,a)}static _updateAttributes(t,e){if(t instanceof ShadowRoot||e instanceof ShadowRoot)return;const a=t.attributes,i=e.attributes;for(let t=a.length-1;t>=0;--t){const i=a[t];i.namespaceURI?e.getAttributeNS(i.namespaceURI,i.localName)!=i.value&&e.setAttributeNS(i.namespaceURI,i.localName,i.value):e.hasAttribute(i.localName)?e.getAttribute(i.localName)!=i.value&&("null"==i.value||"undefined"==i.value?e.removeAttribute(i.localName):e.setAttribute(i.localName,i.value)):e.setAttribute(i.localName,i.value)}for(let a=i.length-1;a>=0;--a){const s=i[a];0!=s.specified&&(s.namespaceURI?t.hasAttributeNS(s.namespaceURI,s.localName)||e.removeAttributeNS(s.namespaceURI,s.localName):t.hasAttributeNS(null,s.localName)||e.removeAttribute(s.localName))}}static _updateInput(t,a){e._updateAttribute(t,a,"checked"),e._updateAttribute(t,a,"disabled"),t.value!=a.value&&(a.setAttribute("value",t.value),a.value=t.value),""==t.value&&a.removeAttribute("value"),t.hasAttributeNS(null,"value")?"range"==a.type&&(a.value=t.value):a.removeAttribute("null")}static _updateTextArea(t,e){t.value!=e.value&&(e.value=t.value),e.firstChild&&e.firstChild.nodeValue!=t.value&&(e.firstChild.nodeValue=t.value)}static _updateAttribute(t,e,a){t[a]!=e[a]&&(e[a]=t[a],t[a]?e.setAttribute(a,""):e.removeAttribute(a))}}class a extends HTMLElement{constructor(){super(),this._container=this.attachShadow({mode:"closed"}),this.state=t.create(()=>{e.compile(this)})}connectedCallback(){this._container.innerHTML=this.render(),e.bindEvents(this),this.didLoad()}disconnectedCallback(){e.unbindEvents(this),this.willUnload()}render(){}didLoad(){}willUnload(){}static register(t,e){window.customElements.define(t,e)}}class i{constructor(a){this._container=a,this.state=t.create(()=>{e.compile(this)})}render(){}didLoad(){}static render(t){e.compile(t),e.bindEvents(t),t.didLoad()}}class s{constructor(t){this._routes=t,this._parsedRoutes=this._parseRoutes(),this._useHashRouting=!1}on(t,e){this._routes[t]=e,this._parsedRoutes=this._parsedRoutes()}setRouteNotFound(t){this._routes.ERROR_404=t}navigate(t){window.history.pushState({},t,window.location.origin+t),this._resolveRoute(t)}listen(t=!1){this._useHashRouting=t,this._useHashRouting?window.addEventListener("hashchange",()=>{this._resolveRoute(this._getCurrentUrl())}):window.addEventListener("popstate",()=>{this._resolveRoute(this._getCurrentUrl())}),this._resolveRoute(this._getCurrentUrl())}static getParameters(){return s.routeParameters}_getCurrentUrl(){const t=(this._useHashRouting?window.location.hash.slice(1)||"/":window.location.pathname||"/").toLowerCase();return t.endsWith("/")&&t.length>1?t.slice(0,-1):t}_parseRoutes(){return Object.keys(this._routes).sort((t,e)=>e.length-t.length).map(t=>({url:new RegExp("^"+t.replace(/:[^\s/]+/g,"([\\w-]+)")+"$"),view:this._routes[t],pathname:t}))}_getUrlParameters(t,e){const a={},i=t.pathname.split("/");let s=1;for(let t of i)t.startsWith(":")&&(a[t.substring(1)]=e[s],s++);return a}_resolveRoute(t){let e=null;for(let a of this._parsedRoutes)if(e=t.match(a.url),e)return s.routeParameters=this._getUrlParameters(a,e),void i.render(this._routes[a.pathname]);if(!e){const e=this._routes.ERROR_404;if(!e)return void document.write(`ERROR 404: ${t} not found!`);i.render(e)}}}s.routeParameters={};const r=async function(t,e,a={}){const i=await fetch(t,{method:"POST",body:JSON.stringify(e),headers:Object.assign({"Content-type":"application/json; charset=UTF-8"},a)});return{headers:i.headers,status:i.status,type:i.type,url:i.url,data:i.json()}};class n{constructor(){this.playing=[]}play(t){let e=n.context.createBufferSource();e.buffer=t.buffer,e.connect(t.gainNode),e.loop=t.looping,t.node=e,t.node.start(0),this.playing.push(t)}stop(t){this.playing.includes(t)&&(t.node.stop(0),this.playing.splice(this.playing.indexOf(t),1))}pause(t){this.playing.includes(t)&&(t.node.disconnect(t.gainNode),this.playing.splice(this.playing.indexOf(t),1))}resume(t){this.playing.includes(t)||(t.node.connect(t.gainNode),this.playing.push(t))}isPlaying(t){return this.playing.includes(t)}static unlock(){try{let t=window.AudioContext||window.webkitAudioContext;if(n.context=new t,"suspended"==n.context.state){let t=function(){n.context.resume().then((function(){document.body.removeEventListener("touchstart",t),document.body.removeEventListener("touchend",t),document.body.removeEventListener("click",t)}))};document.body.addEventListener("touchstart",t),document.body.addEventListener("touchend",t),document.body.addEventListener("click",t)}}catch(t){console.log("WebAudio API is not supported!")}}}n.context=null;class o{constructor(t,e=gl.STATIC_DRAW){this.type=t,this.mode=e,this.buffer=gl.createBuffer()}bind(){gl.bindBuffer(this.type,this.buffer)}data(t){gl.bufferData(this.type,t,this.mode)}subData(t,e=0){gl.bufferSubData(this.type,e,t)}unbind(){gl.bindBuffer(this.type,null)}delete(){gl.deleteBuffer(this.buffer)}}class l extends o{constructor(t=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,t),super.bind(),super.data(new Float32Array([.5,.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(0),gl.vertexAttribPointer(0,3,gl.FLOAT,!1,0,0)}disable(){super.unbind(),gl.disableVertexAttribArray(0)}}class h{constructor(t=window.innerWidth,e=window.innerHeight){this.canvas=document.createElement("canvas"),this.canvas.id="SkylarkDisplay",this.canvas.width=t,this.canvas.height=e,this.options={alpha:!1},this.then=0,this.tolerance=.1}create(){if(window.gl=this.canvas.getContext("webgl",this.options),!gl)throw new Error("WebGL is not supported!");document.body.appendChild(this.canvas),gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),class{static init(){(new l).enable(),n.unlock()}}.init()}set(t){this.options=Object.assign(this.options,t)}resize(t=window.innerWidth,e=window.innerHeight){this.canvas.width=t,this.canvas.height=e,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight)}clear(t=0,e=0,a=0){gl.clear(gl.COLOR_BUFFER_BIT),gl.clearColor(t,e,a,1)}get width(){return this.canvas.width}get height(){return this.canvas.height}}class d{constructor(){this.data=new Float32Array(16),this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1}copy(t){this.data=t.data}identity(){this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=1,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=1,this.data[11]=0,this.data[12]=0,this.data[13]=0,this.data[14]=0,this.data[15]=1}translate(t,e,a){this.data[12]=this.data[0]*t+this.data[4]*e+this.data[8]*a+this.data[12],this.data[13]=this.data[1]*t+this.data[5]*e+this.data[9]*a+this.data[13],this.data[14]=this.data[2]*t+this.data[6]*e+this.data[10]*a+this.data[14],this.data[15]=this.data[3]*t+this.data[7]*e+this.data[11]*a+this.data[15]}rotateX(t){let e=Math.sin(t),a=Math.cos(t);this.data[4]*=a+this.data[8]*e,this.data[5]*=a+this.data[9]*e,this.data[6]*=a+this.data[10]*e,this.data[7]*=a+this.data[11]*e,this.data[8]*=a-this.data[4]*e,this.data[9]*=a-this.data[5]*e,this.data[10]*=a-this.data[6]*e,this.data[11]*=a-this.data[7]*e}rotateY(t){let e=Math.sin(t),a=Math.cos(t);this.data[0]*=a-this.data[8]*e,this.data[1]*=a-this.data[9]*e,this.data[2]*=a-this.data[10]*e,this.data[3]*=a-this.data[11]*e,this.data[8]=this.data[0]*e+this.data[8]*a,this.data[9]=this.data[1]*e+this.data[9]*a,this.data[10]=this.data[2]*e+this.data[10]*a,this.data[11]=this.data[3]*e+this.data[11]*a}rotateZ(t){let e=Math.sin(t),a=Math.cos(t);this.data[0]*=a+this.data[4]*e,this.data[1]*=a+this.data[5]*e,this.data[2]*=a+this.data[6]*e,this.data[3]*=a+this.data[7]*e,this.data[4]*=a-this.data[0]*e,this.data[5]*=a-this.data[1]*e,this.data[6]*=a-this.data[2]*e,this.data[7]*=a-this.data[3]*e}scale(t,e,a){this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this.data[4]*=e,this.data[5]*=e,this.data[6]*=e,this.data[7]*=e,this.data[8]*=a,this.data[9]*=a,this.data[10]*=a,this.data[11]*=a}orthographic(t,e,a,i,s,r){let n=1/(t-e),o=1/(a-i),l=1/(s-r);this.data[0]=-2*n,this.data[5]=-2*o,this.data[10]=2*l,this.data[12]=(t+e)*n,this.data[13]=(i+a)*o,this.data[14]=(r+s)*l}lookAt(t,e,a){Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6&&Math.abs(t.z-e.z)<1e-6&&this.identity();let i=t.x-e.x,s=t.y-e.y,r=t.z-e.z,n=1/Math.hypot(i,s,r);i*=n,s*=n,r*=n;let o=a.y*r-a.z*s,l=a.z*i-a.x*r,h=a.x*s-a.y*i;n=Math.hypot(o,l,h),n?(n=1/n,o*=n,l*=n,h*=n):(o=0,l=0,h=0);let d=s*h-r*l,c=r*o-i*h,u=i*l-s*o;n=Math.hypot(d,c,u),n?(n=1/n,d*=n,c*=n,u*=n):(d=0,c=0,u=0),this.data[0]=o,this.data[1]=d,this.data[2]=i,this.data[4]=l,this.data[5]=c,this.data[6]=s,this.data[8]=h,this.data[9]=u,this.data[10]=r,this.data[12]=-(o*t.x+l*t.y+h*t.z),this.data[13]=-(d*t.x+c*t.y+u*t.z),this.data[14]=-(i*t.x+s*t.y+r*t.z)}static invert(t){let e=t.data,a=new d,i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],g=e[9],m=e[10],p=e[11],w=e[12],f=e[13],y=e[14],b=e[15],E=i*l-s*o,x=i*h-r*o,v=i*c-n*o,_=s*h-r*l,T=s*c-n*l,A=r*c-n*h,R=u*f-g*w,S=u*y-m*w,k=u*b-p*w,P=g*y-m*f,I=g*b-p*f,L=m*b-p*y,D=E*L-x*I+v*P+_*k-T*S+A*R;return D?(D=1/D,a.data[0]=(l*L-h*I+c*P)*D,a.data[1]=(r*I-s*L-n*P)*D,a.data[2]=(f*A-y*T+b*_)*D,a.data[3]=(m*T-g*A-p*_)*D,a.data[4]=(h*k-o*L-c*S)*D,a.data[5]=(i*L-r*k+n*S)*D,a.data[6]=(y*v-w*A-b*x)*D,a.data[7]=(u*A-m*v+p*x)*D,a.data[8]=(o*I-l*k+c*R)*D,a.data[9]=(s*k-i*I-n*R)*D,a.data[10]=(w*T-f*v+b*E)*D,a.data[11]=(g*v-u*T-p*E)*D,a.data[12]=(l*S-o*P-h*R)*D,a.data[13]=(i*P-s*S+r*R)*D,a.data[14]=(f*x-w*_-y*E)*D,a.data[15]=(u*_-g*x+m*E)*D,a):null}static multiply(t,e){let a=t.data,i=e.data,s=new d,r=a[0],n=a[1],o=a[2],l=a[3],h=a[4],c=a[5],u=a[6],g=a[7],m=a[8],p=a[9],w=a[10],f=a[11],y=a[12],b=a[13],E=a[14],x=a[15],v=i[0],_=i[1],T=i[2],A=i[3];return s.data[0]=v*r+_*h+T*m+A*y,s.data[1]=v*n+_*c+T*p+A*b,s.data[2]=v*o+_*u+T*w+A*E,s.data[3]=v*l+_*g+T*f+A*x,v=i[4],_=i[5],T=i[6],A=i[7],s.data[4]=v*r+_*h+T*m+A*y,s.data[5]=v*n+_*c+T*p+A*b,s.data[6]=v*o+_*u+T*w+A*E,s.data[7]=v*l+_*g+T*f+A*x,v=i[8],_=i[9],T=i[10],A=i[11],s.data[8]=v*r+_*h+T*m+A*y,s.data[9]=v*n+_*c+T*p+A*b,s.data[10]=v*o+_*u+T*w+A*E,s.data[11]=v*l+_*g+T*f+A*x,v=i[12],_=i[13],T=i[14],A=i[15],s.data[12]=v*r+_*h+T*m+A*y,s.data[13]=v*n+_*c+T*p+A*b,s.data[14]=v*o+_*u+T*w+A*E,s.data[15]=v*l+_*g+T*f+A*x,s}}class c{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}transformMat4(t){let e=this.x,a=this.y;this.x=t.data[0]*e+t.data[4]*a+t.data[12],this.y=t.data[1]*e+t.data[5]*a+t.data[13]}}class u{constructor(t=0,e=0,a=0){this.x=t,this.y=e,this.z=a}set(t,e,a){this.x=t,this.y=e,this.z=a}}class g{constructor(t=gl.canvas.width,e=gl.canvas.height,a=!0){this.width=t,this.height=e,this.position=new c(0,0),this.viewMatrix=new d,this.projectionMatrix=new d,this.combined=new d,a?this.projectionMatrix.orthographic(-this.width/2,this.width/2,-this.height/2,this.height/2,-1,1e3):this.projectionMatrix.orthographic(0,this.width,0,this.height,-1,1e3),this.update()}update(){this.viewMatrix.lookAt(new u(this.position.x,this.position.y,10),new u(this.position.x,this.position.y,0),new u(0,1,0)),this.combined=d.multiply(this.projectionMatrix,this.viewMatrix)}setPosition(t,e){this.position.set(t,e)}inView(t,e){return t>=this.position.x&&t<=this.position.x+this.width&&e>=this.position.y&&e<=this.position.y+this.height}unproject(t,e){let a=d.invert(this.combined),i=new c(2*t/gl.canvas.width-1,-2*e/gl.canvas.height+1);return i.transformMat4(a),i}}class m{constructor(){this.program=gl.createProgram()}compile(t,e){let a=this.loadShader(t,gl.VERTEX_SHADER),i=this.loadShader(e,gl.FRAGMENT_SHADER);if(gl.attachShader(this.program,a),gl.attachShader(this.program,i),this.bindAttributes(),gl.linkProgram(this.program),gl.validateProgram(this.program),!gl.getProgramParameter(this.program,gl.LINK_STATUS)){let t=gl.getProgramInfoLog(this.program);throw gl.deleteProgram(this.program),gl.deleteShader(a),gl.delteteShader(i),new Error("SHADER_PROGRAM: "+t)}}start(){gl.useProgram(this.program)}stop(){gl.useProgram(null)}bindAttribute(t,e){gl.bindAttribLocation(this.program,t,e)}bindAttributes(){this.bindAttribute(0,"a_position"),this.bindAttribute(1,"a_texCoords")}getAttributeLocation(t){return gl.getAttribLocation(this.program,t)}getUniformLocation(t){return gl.getUniformLocation(this.program,t)}extractUniforms(){let t={},e=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);for(let a=0;a<e;a++){let e=gl.getActiveUniform(this.program,a),i=e.name.replace("[0]",""),s=this.getUniformLocation(i);t[i]={name:i,location:s,type:e.type}}return t}loadFloat(t,e){gl.uniform1f(t,e)}loadVector2(t,e){gl.uniform2f(t,e.x,e.y)}loadVector3(t,e){gl.uniform3f(t,e.x,e.y,e.z)}loadMatrix4(t,e){gl.uniformMatrix4fv(t,!1,e.data)}loadShader(t,e){let a=gl.createShader(e);if(gl.shaderSource(a,t),gl.compileShader(a),!gl.getShaderParameter(a,gl.COMPILE_STATUS)){let t;e==gl.VERTEX_SHADER?t="VERTEX_SHADER":e==gl.FRAGMENT_SHADER&&(t="FRAGMENT_SHADER");let i=gl.getShaderInfoLog(a);throw gl.deleteShader(a),new Error(`${t}: ${i}`)}return a}}class p{constructor(t,e){this.id=Math.random(),this.shader=new m,this.shader.compile(t,e),this.uniforms=this.shader.extractUniforms()}use(){p.currentID!=this.id&&(p.currentID=this.id,this.shader.start()),this.prepare()}prepare(){}set(t,e){let a=this.uniforms[t];switch(a.type){case gl.FLOAT:this.shader.loadFloat(a.location,e);break;case gl.FLOAT_VEC2:this.shader.loadVector2(a.location,e);break;case gl.FLOAT_VEC3:this.shader.loadVector3(a.location,e);break;case gl.FLOAT_MAT4:this.shader.loadMatrix4(a.location,e);break;default:throw new Error(e+" is not a compatible value type!")}}}p.currentID=0;class w extends o{constructor(t=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,t),super.bind(),super.data(new Float32Array([1,1,0,1,1,0,0,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(1),gl.vertexAttribPointer(1,2,gl.FLOAT,!1,0,0)}disable(){gl.disableVertexAttribArray(1),super.unbind()}}const f="\n    attribute vec3 a_position;\n    attribute vec2 a_texCoords;\n\n    varying vec2 v_texCoords;\n\n    uniform mat4 u_model;\n    uniform mat4 u_viewProjection;\n\n    void main(void) {\n        gl_Position = u_viewProjection * u_model * vec4(a_position, 1.0);\n        v_texCoords = a_texCoords;\n    }\n",y="\n    precision mediump float;\n\n    varying vec2 v_texCoords;\n\n    uniform sampler2D u_image;\n    uniform vec3 u_color;\n\n    void main(void) {\n        \n        gl_FragColor = texture2D(u_image, v_texCoords) * vec4(u_color, 1.0);\n    }\n";class b extends p{constructor(t){super(f,y),this.image=t,this.textureID=t.textureID,this.tint=new u(1,1,1),this.textureBuffer=new w}prepare(){this.textureBuffer.enable(),gl.bindTexture(gl.TEXTURE_2D,this.textureID),super.set("u_color",this.tint)}setTint(t,e,a){this.tint.set(t/255,e/255,a/255)}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}}class E extends p{constructor(t){super(f,y),this.image=t,this.textureID=t.textureID,this.tint=new u(1,1,1),this.region=[1,1,0,1,1,0,0,0],this.regionX=0,this.regionY=0,this.regionWidth=this.image.naturalWidth,this.regionHeight=this.image.naturalHeight,this.textureBuffer=new w(gl.DYNAMIC_DRAW)}prepare(){this.textureBuffer.enable(),gl.bindTexture(gl.TEXTURE_2D,this.textureID),super.set("u_color",this.tint)}setTint(t,e,a){this.tint.set(t/255,e/255,a/255)}setRegion(t,e,a,i){let s={};s.left=t/this.image.naturalWidth,s.right=(t+a)/this.image.naturalWidth,s.bottom=e/this.image.naturalHeight,s.top=(e+i)/this.image.naturalHeight,this.region=[s.right,s.top,s.left,s.top,s.right,s.bottom,s.left,s.bottom],this.regionX=t,this.regionY=e,this.regionWidth=a,this.regionHeight=i,this.textureBuffer.bind(),this.textureBuffer.subData(new Float32Array(this.region))}setRegionUV(t,e,a,i){this.region=[e,i,t,i,e,a,t,a]}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}}class x extends E{constructor(t){super(t),this.animationType=0,this.updateInterval=1,this.currentAdvance=1,this.currentFrame=0,this.currentTick=0}prepare(){super.prepare(),this.update()}setSequence(t,e,a,i,s,r=0){this.frameX=t,this.frameY=e,this.frameWidth=a,this.frameHeight=i,this.widthPadding=r,this.frameCount=s,this.updateFrame()}setSpeed(t){this.updateInterval=t}update(){this.currentTick++,this.currentTick>=this.updateInterval&&(this.currentTick=0,this.currentFrame+=this.currentAdvance,this.currentFrame>=0&&this.currentFrame<this.frameCount?this.updateFrame():(this.currentTick=0,this.currentFrame=0))}updateFrame(){let t=this.frameX+this.currentFrame*(this.frameWidth+this.widthPadding);super.setRegion(t,this.frameY,this.frameWidth,this.frameHeight)}}class v{constructor(){this.origin=new c(0,0),this.position=new c(0,0),this.scale=new c(1,1),this.rotationInRadians=0,this.matrix=new d}setRotation(t){for(this.rotationInRadians=t;this.rotationInRadians>2*Math.PI;)this.rotationInRadians-=2*Math.PI}update(){this.matrix.identity(),this.matrix.translate(this.x+this.origin.x,this.y+this.origin.y,0),this.matrix.rotateZ(this.rotationInRadians),this.matrix.scale(this.width,this.height,1)}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}get width(){return this.scale.x}set width(t){this.scale.x=t}get height(){return this.scale.y}set height(t){this.scale.y=t}}class _{constructor(t){this.material=t,this.transform=new v,this.setPosition(0,0),this.setSize(100,100)}draw(t){this.material.use(),this.transform.update(),this.material.set("u_model",this.transform.matrix),this.material.set("u_viewProjection",t.combined),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}setMaterial(t){this.materia=t}setOrigin(t,e){this.transform.origin.set(t,e)}setPosition(t,e){this.transform.position.set(t,e)}setSize(t,e){this.transform.scale.set(t,e)}setRotation(t){this.transform.setRotation(t)}}Object.freeze({LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",SPACE:" ",TAB:"Tab",SHIFT:"Shift",BACKQUOTE:"`",ESCAPE:"Escape",CONTROL:"Control",META:"meta",BACKSPACE:"Backspace",ENTER:"Enter",SLASH:"/",ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z"}),Object.freeze({LEFT:0,MIDDLE:1,RIGHT:2});class T{static load(t="string",e="Object"){throw new Error(`[Unimplemented Function]: LoaderInterface.load(${t}, ${e})`)}static unload(t,e){delete e[t]}static isLoaded(t,e){return t in e}}class A extends T{static load(t,e){if(super.isLoaded(t,e))return;let a=new Image;return new Promise((function(i,s){a.addEventListener("load",(function(){let s=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a),gl.bindTexture(gl.TEXTURE_2D,null),a.textureID=s,e[t]=a,i()})),a.addEventListener("error",(function(){s(new Error("Failed to load asset: "+t))})),a.src=t}))}static unload(t,e){gl.deleteTexture(e[t].textureID),super.unload(t,e)}}class R extends T{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(a,i){fetch(t).then(t=>t.json()).then(i=>{e[t]=i,a()}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}}class S extends T{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(a,i){fetch(t).then(t=>t.text()).then(i=>{e[t]=i,a()}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}}class k extends T{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(a,i){fetch(t).then(t=>t.arrayBuffer()).then(i=>{n.context.decodeAudioData(i,(function(i){e[t]=i,a()}))}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}}class P extends T{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(a,i){fetch(t).then(t=>t.json()).then(s=>{P.loadTilesets(s,e,t,a,i)}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}static unload(t,e){let a=e[t].data.tilesets;for(let t=0;t<a.length;t++)gl.deleteTexture(e[a[t].image].textureID);super.unload(t,e)}static loadTilesets(t,e,a,i,s){let r=t.tilesets.length,n=0;for(let o=0;o<r;o++){let l=new Image;l.addEventListener("load",(function(){e[t.tilesets[o].image]=l,n++,n==r&&P.splitTiles(t,e,a,i,s)})),l.addEventListener("error",(function(){s(new Error("Failed to load asset: "+a))})),l.src=t.tilesets[o].image}}static splitTiles(t,e,a,i,s){let r=[],n=t.tilesets.length;for(let a=0;a<n;a++)r.push(e[t.tilesets[a].image]);let o=[];for(let e=0;e<r.length;e++){let a=r[e].width/t.tilewidth,i=r[e].height/t.tileheight;for(let s=0;s<i;s++)for(let i=0;i<a;i++){let a=document.createElement("canvas"),n=a.getContext("2d");n.width=t.tilewidth,n.height=t.tileheight;let l=i*t.tilewidth,h=s*t.tileheight;n.drawImage(r[e],-l,-h),o.push(a)}}P.predraw(t,e,a,r,o,i,s)}static predraw(t,e,a,i,s,r,n){let o=document.createElement("canvas");o.width=t.width*t.tilewidth,o.height=t.height*t.tileheight;let l=o.getContext("2d");for(let e=0;e<t.layers.length;e++){let a=0,i=0;if("tilelayer"==t.layers[e].type)for(let r=0;r<t.layers[e].data.length;r++){if(r%t.width==0&&0!=r&&(i+=t.tileheight,a=0),0!=t.layers[e].data[r]){let n=s[t.layers[e].data[r]];l.drawImage(n,a,i)}a+=t.tilewidth}}let h=new Image;h.addEventListener("load",(function(){let s=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,h),gl.bindTexture(gl.TEXTURE_2D,null),h.textureID=s,e[a]={data:t,tilesets:i,image:h},r()})),h.addEventListener("error",(function(){n(new Error("Failed to load asset: "+a))})),h.src=o.toDataURL("image/png")}}class I{constructor(){this.queue=[],this.cache={},this.loaderTypes={png:A,jpg:A,jpeg:A,json:R,tiled:P,glsl:S,vert:S,frag:S,mp3:k,wav:k,ogg:k}}get(t){return this.cache[t]}add(t,e){if(Array.isArray(t))for(let a of t)this.queue.push(this.getLoadFunction(a,e));else this.queue.push(this.getLoadFunction(t,e))}load(t,e){if(Array.isArray(t)){let a=[];for(let i of t)a.push(this.getLoaderFunction(i,e));return Promise.all(a)}return this.getLoadFunction(t,e)}loadAssets(){return Promise.all(this.queue)}unload(t,e){this.loaderTypes[this.getType(t,e)].unload(t,this.cache)}empty(){this.queue=[]}clear(){this.queue=[];for(let t of Object.keys(this.cache))this.loaderTypes[this.getType(t)].unload(t,this.cache)}registerType(t,e){this.loaderTypes[t]?console.error(t+" already a registed asset type!"):this.loaderTypes[t]=e}getLoadFunction(t,e){let a=this.getType(t,e);if(this.loaderTypes.hasOwnProperty(a))return this.loaderTypes[a].load(t,this.cache);throw new Error("Unknown asset type: "+a)}getType(t,e){if(e)return e;{let e=t.split(".");return e[e.length-1]}}}Object.freeze({TEXTURE:"png",JSON:"json",SHADER:"glsl",AUDIO:"mp3",TILEDMAP:"tiled"});class L{constructor(t,e,a,i){this.x=t,this.y=e,this.width=a,this.height=i,this.right=this.x+this.width,this.bottom=this.y+this.height}setPosition(t,e){this.x=t,this.y=e}setSize(t,e){this.width=t,this.height=e}overlaps(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}within(t){return t.x>=this.x&&t.right<=this.right&&t.y<=this.y&&t.bottom>=this.bottom}contains(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom}}class D{constructor(){this.active=!1,this.FPS=60,this.MPF=1e3/this.FPS,this.lastTime=0,this.lagTime=0,this.currentTime=0,this.elapsedTime=0}async create(){}render(){}update(){}dispose(){}static async setScreen(t){null!=D.currentScreen&&(D.currentScreen.active=!1),D.currentScreen=t,t.previousTime=performance.now(),t.active=!0,await t.create(),requestAnimationFrame(t.renderLoop.bind(t))}renderGUI(t){try{document.getElementById("skylark-gui").innerHTML=t}catch{throw new Error('Element with id: "skylark-gui" not found!')}}renderLoop(){if(this.active){for(requestAnimationFrame(this.renderLoop.bind(this)),this.currentTime=performance.now(),this.elapsedTime=this.currentTime-this.lastTime,this.lastTime=this.currentTime,this.lagTime+=this.elapsedTime;this.lagTime>=this.MPF&&this.active;)this.update(),this.lagTime-=this.MPF;this.render()}else this.dispose()}}D.currentScreen=null;class M{static on(t,e){M.events[t]=e,window.addEventListener(t,e)}static remove(t,e){delete M.events[t],window.removeEventListener(t,e)}static emit(t){M.events[t]()}static isPortrait(){return window.innerHeight>window.innerWidth}static isLandscape(){return window.innerWidth>window.innerHeight}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static toggleFullscreen(){document.fullscreenEnabled&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen())}static togglePointerLock(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.body.requestPointerLock()}}M.events={};class N extends _{constructor(t,e,a,i,s){super(s),this.x=t,this.y=e,super.setPosition(t,e),this.rect=new L(t,e,a,i),this.width=a,this.height=i,this.setSize(a,i),this.direction={up:!1,down:!1,left:!1,right:!1}}setAnimation(t){super.setMaterial(t)}move(t,e){this.x=t,this.y=e,super.setPosition(t,e)}}class F extends WebSocket{constructor(t,e,a){super(t),this.email=e,this.password=a}trackOpen(){super.onopen=()=>{this.send({type:"connect",email:this.email,password:this.password})}}trackMessage(){super.onmessage=t=>{switch((t=JSON.parse(t.data)).type){case"status":console.log(t),t.login&&this.send({type:"loadPlayers"});break;case"setWorld":game.world=t.world;break;case"setPlayers":game.players=[];for(let e in t.players){let a=t.players[e],i=new N(a.x,a.y,96,96,game.animations.base_idle_right);i.id=a.id,game.players.push(i)}break;case"updatePlayer":game.players.find(e=>e.id==t.player.id).move(t.player.x,t.player.y);break;case"setID":game.playerID=t.id;break;case"chatMessage":document.getElementById("chatBox").state.messages+=t.message+";"}}}trackError(){super.onerror=t=>{if(t)throw t}}trackClose(){super.onclose=()=>{window.location="/"}}send(t){t=JSON.stringify(t),super.send(t)}}class U{static setup(){game.display=new h(window.innerWidth,window.innerHeight),game.display.create(),game.loader=new I,game.camera=new g(window.innerWidth,window.innerHeight),M.on("resize",()=>{game.display.resize(window.innerWidth,window.innerHeight)}),document.getElementById("chatBox").style.display="block"}static async loadAssets(){game.loader.add("assets/Base_Sprite_Walk.png"),game.loader.add("assets/cobble.png"),await game.loader.loadAssets(),game.assets.base_walk=game.loader.get("assets/Base_Sprite_Walk.png"),game.assets.cobble=game.loader.get("assets/cobble.png"),U.setAnimations(),U.setMaterials()}static setAnimations(){game.animations.base_idle_right=new x(game.assets.base_walk),game.animations.base_idle_right.setSequence(144,0,48,48,1),game.animations.base_walk_right=new x(game.assets.base_walk),game.animations.base_walk_right.setSequence(0,0,48,48,3),game.animations.base_walk_right.setSpeed(10),game.animations.base_walk_left=new x(game.assets.base_walk),game.animations.base_walk_left.setSequence(192,0,48,48,3)}static setMaterials(){game.materials.cobble=new b(game.assets.cobble)}}class C extends _{constructor(t,e,a,i,s,r){super(r),this.x=t,this.y=e,this.width=a,this.height=i,super.setPosition(this.x,this.y),super.setSize(this.width,this.height),this.rect=new L(this.x-this.width/2,this.y-this.height/2,this.width,this.height),this.type=s}}class O{static findSector(t,e){for(let a of game.world.map){let i=new C(a.x,a.y,96,96,a.type,game.materials[a.tile]);if(i.rect.contains(t,e))return i}}static collidesWithObject(t,e,a){if(game.world){t.rect.x+=e,t.rect.y+=a;for(let e of game.world.map)if("wall"==e.type&&e.rect.collides(t.rect))return!0;return!1}}static movement(t){try{let e=game.players.find(t=>t.id==game.playerID);e.direction.up&&(O.collidesWithObject(e,0,5)||t.send({type:"move",pos:{x:e.x,y:e.y+5}})),e.direction.left&&(O.collidesWithObject(e,-5,0)||t.send({type:"move",pos:{x:e.x-5,y:e.y}})),e.direction.down&&(O.collidesWithObject(e,0,-5)||t.send({type:"move",pos:{x:e.x,y:e.y-5}})),e.direction.right&&(O.collidesWithObject(e,5,0)||t.send({type:"move",pos:{x:e.x+5,y:e.y}}))}catch(t){}}}class B{static windowKeys(){console.log(game.playerID),console.log(game.players);let t=game.players.find(t=>t.id==game.playerID);window.addEventListener("keydown",e=>{if(t=game.players.find(t=>t.id==game.playerID),document.activeElement==document.getElementById("chatBox"));else switch(e.key){case"w":t.direction.up=!0;break;case"a":t.direction.left=!0;break;case"s":t.direction.down=!0;break;case"d":t.direction.right=!0}}),window.addEventListener("keyup",e=>{switch(t=game.players.find(t=>t.id==game.playerID),e.key){case"w":t.direction.up=!1;break;case"a":t.direction.left=!1;break;case"s":t.direction.down=!1;break;case"d":t.direction.right=!1}})}static windowClick(){window.addEventListener("mousedown",t=>{let e,a=game.camera.unproject(t.clientX,t.clientY);switch(a.x=Math.floor(a.x),a.y=Math.floor(a.y),t.button){case 0:if(e=O.findSector(a.x,a.y),null!=e)for(let t in game.world.map){let a=game.world.map[t];a.rect=new L(Math.floor(a.x)/96*96-48,Math.floor(a.y)/96*96-48,96,96),e.rect.contains(a.x,a.y)&&game.world.map.splice(t,1)}break;case 1:break;case 2:e=O.findSector(a.x,a.y),null==e&&game.world.map.push({tile:"cobble",type:"backdrop",x:96*Math.floor(a.x/96),y:96*Math.floor(a.y/96)})}}),window.addEventListener("contextmenu",t=>{t.preventDefault()})}}class W extends D{constructor(t,e,a){super(),window.game={animations:{},assets:{},id:1,materials:{},players:[]},window.ws=new F(t,e,a),ws.trackOpen(),ws.trackMessage(),ws.trackError(),ws.trackClose()}create(){U.setup(),U.loadAssets(),B.windowKeys(),B.windowClick()}update(){O.movement(ws);let t=game.players.find(t=>t.id==game.playerID);game.camera.setPosition(t.x,t.y),game.camera.update()}render(){if(game.display.clear(),game.world)for(let t in game.world.map){let e=game.world.map[t];new C(e.x,e.y,96,96,e.type,game.materials[e.tile]).draw(game.camera)}for(let t=0;t<game.players.length;t++)game.players[t].draw(game.camera)}}a.register("login-screen",class extends a{constructor(){super(),this.state.status=""}render(){return`\n        <style>\n            form {\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                margin: auto;\n                height: 50%;\n                position: absolute;\n                top: 45%;\n                left: 25%;\n                color: white;\n            }\n            \n            .menu {\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                margin: auto;\n                height: 50%;\n                position: absolute;\n                top: 45%;\n                left: 25%;\n                color: white;\n            }\n            \n            form * {\n                background-color: transparent;\n                height: 10%;\n                color: white;\n            }\n            \n            #status {\n                width: 100%;\n                height: auto;\n            }\n            \n            #background {\n                width: 100%;\n                height: 10%;\n                margin: auto;\n            }\n            \n            #chat {\n                color: white;\n                position: absolute;\n                bottom: 2.5%;\n                left: 5%;\n                height: 30%;\n                width: 35%;\n                background-color: rgba(240, 248, 255, 0.05);\n                overflow-x: none;\n                overflow-y: scroll;\n            }\n            \n            #chatMessage {\n                height: 2.5%;\n                position: absolute;\n                left: 5%;\n                bottom: 0%;\n                width: 35%;\n                background-color: rgba(240, 248, 255, 0.05);\n                overflow-x: scroll;\n                overflow-y: none;\n                color: white;\n            }\n            </style>\n\n            <img src="assets/logo.png" id="background" />\n            <form @submit="validateAccount">\n                <input id="email" type="email" placeholder="Email" name="email" for="email"/>\n                <input id="password" type="password" placeholder="Password" name="password" for="password" />\n                <button type="submit">Connect</button>\n                <span>${this.state.status}</span>\n            </form>\n        `}async validateAccount(t){t.preventDefault();let e=t.path[0][0].value.toLowerCase(),a=t.path[0][1].value;const i=await r("/login",{email:e,password:a});201==i.status?i.data.then(t=>{this.style.display="none",D.setScreen(new W(t.socket,e,a));let i=new Audio("assets/main.mp4");i.loop=!0,i.play()}):i.data.then(t=>{this.state.status=t.reason})}}),a.register("chat-window",class extends a{constructor(){super(),this.state.messages=""}render(){return`\n        <style>\n            :host {\n                background-color: rgba(255, 255, 255, 0.5);\n                width: 25%;\n                height: 30%;\n                position: absolute;\n                bottom: 0%;\n                left: 0%;\n            }\n\n            #messages{\n                position: absolute;\n                bottom: 10%;\n                left: 0%;\n                width: 99.5%;\n                height: 90%;\n            }\n\n            #chatInput{\n                position: absolute;\n                bottom: 0%;\n                left: 0%;\n                height: 10%;\n                width: 99.5%;\n                background-color: transparent;\n                border: 1px solid black;\n            }\n        </style>\n\n        <form @submit="sendMessage">\n            <div id="messages" class="chatBoxElement">\n            ${this._updateMessages(this.state.messages)}\n            </div>\n            <input id="chatInput" class="chatBoxElement" placeholder="Send Message"/>\n        </form>\n        `}sendMessage(t){t.preventDefault();let e=t.path[0][0];ws.send({type:"chatMessage",message:e.value}),e.value=""}_updateMessages(t){let e="";const a=t.split(/;/g);for(let t of a)e+=`<span>${t}</span><br>`;return e}});a.register("input-verification",class extends a{constructor(){super(),this.state.response=""}render(){return`\n            <form @submit="sendUsername">\n                <input placeholder="Input username here" />\n            </form>\n\n            <span style="color: white;">${this.state.response}</span>\n        `}async sendUsername(t){t.preventDefault();const{token:e}=s.getParameters();(await r("/verify",{token:e,username:t.path[0][0].value})).data.then(t=>{this.state.response=t.status})}});new s({"/":new class extends i{render(){return'\n            <login-screen id="loginScreen"></login-screen>\n            <chat-window id="chatBox"></chat-window>\n        '}didLoad(){document.getElementById("chatBox").style.display="none"}}(document.getElementById("app")),"/verify/:token":new class extends i{render(){return"\n            <input-verification></input-verification>\n        "}}(document.getElementById("app"))}).listen()}();