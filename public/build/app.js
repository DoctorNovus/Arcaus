!function(){"use strict";class t{set(t){this.prototype=Object.assign(this,t)}static create(e){return new Proxy(new t,{set:(t,s,i)=>"prototype"==s||t[s]==i||(null!=t[s]?(t[s]=i,e(s,i),!0):(t[s]=i,!0))})}}class e{static compile(t){const s=document.createElement("div");s.innerHTML=t.render().replace(/\s+/g," "),e._walk(s,t._container)}static bindEvents(t){const e=t._container.querySelectorAll("*");for(let s of e)for(let e of s.attributes)if(e.localName.startsWith("@")){const i=e.localName.slice(1);s.addEventListener(i,t[e.value].bind(t))}}static unbindEvents(t){const e=t._container.querySelectorAll("*");for(let s of e)for(let e of s.attributes)if(e.localName.startsWith("@")){const i=e.localName.slice(1);s.removeEventListener(i,t[e.value].bind(t))}}static _walk(t,s){return t.isEqualNode(s)||(e._diff(t,s),e._updateChildren(t,s)),s}static _updateChildren(t,s){let i=0;for(let a=0;;a++){const n=s.childNodes[a],r=t.childNodes[a-i];if(!n&&!r)break;if(r)if(n)if(r.isEqualNode(n)){const t=e._walk(r,n);t!==n&&(s.replaceChild(t,n),i++)}else{let t=null;for(let e=a;e<s.childNodes.length;e++)if(s.childNodes[e].isEqualNode(r)){t=s.childNodes[e];break}if(t){const a=e._walk(r,t);a!=t&&i++,s.insertBefore(a,n)}else if(r.id||n.id)s.insertBefore(r,n),i++;else{const t=e._walk(r,n);t!=n&&(s.replaceChild(t,n),i++)}}else s.appendChild(r),i++;else s.removeChild(n),a--}}static _diff(t,s){t.nodeType==Node.ELEMENT_NODE?e._updateAttributes(t,s):s.nodeValue!=t.nodeValue&&(s.nodeValue=t.nodeValue),"INPUT"==t.nodeName?e._updateInput(t,s):"OPTION"==t.nodeName?e._updateAttribute(t,s,"selected"):"TEXTAREA"==t.nodeName&&e._updateTextArea(t,s)}static _updateAttributes(t,e){if(t instanceof ShadowRoot||e instanceof ShadowRoot)return;const s=t.attributes,i=e.attributes;for(let t=s.length-1;t>=0;--t){const i=s[t];i.namespaceURI?e.getAttributeNS(i.namespaceURI,i.localName)!=i.value&&e.setAttributeNS(i.namespaceURI,i.localName,i.value):e.hasAttribute(i.localName)?e.getAttribute(i.localName)!=i.value&&("null"==i.value||"undefined"==i.value?e.removeAttribute(i.localName):e.setAttribute(i.localName,i.value)):e.setAttribute(i.localName,i.value)}for(let s=i.length-1;s>=0;--s){const a=i[s];0!=a.specified&&(a.namespaceURI?t.hasAttributeNS(a.namespaceURI,a.localName)||e.removeAttributeNS(a.namespaceURI,a.localName):t.hasAttributeNS(null,a.localName)||e.removeAttribute(a.localName))}}static _updateInput(t,s){e._updateAttribute(t,s,"checked"),e._updateAttribute(t,s,"disabled"),t.value!=s.value&&(s.setAttribute("value",t.value),s.value=t.value),""==t.value&&s.removeAttribute("value"),t.hasAttributeNS(null,"value")?"range"==s.type&&(s.value=t.value):s.removeAttribute("null")}static _updateTextArea(t,e){t.value!=e.value&&(e.value=t.value),e.firstChild&&e.firstChild.nodeValue!=t.value&&(e.firstChild.nodeValue=t.value)}static _updateAttribute(t,e,s){t[s]!=e[s]&&(e[s]=t[s],t[s]?e.setAttribute(s,""):e.removeAttribute(s))}}class s extends HTMLElement{constructor(){super(),this._container=this.attachShadow({mode:"closed"}),this.state=t.create(()=>{e.compile(this)})}get root(){return this._container}connectedCallback(){this._container.innerHTML=this.render(),e.bindEvents(this),this.didLoad()}disconnectedCallback(){e.unbindEvents(this),this.willUnload()}render(){}didLoad(){}willUnload(){}static register(t,e){window.customElements.define(t,e)}}class i{constructor(s){this._container=s,this.state=t.create(()=>{e.compile(this)})}render(){}didLoad(){}static render(t){e.compile(t),e.bindEvents(t),t.didLoad()}}class a{constructor(t={}){a._routes=t,a._parsedRoutes=this._parseRoutes(),this._useHashRouting=!1}on(t,e){a._routes[t]=e,a._parsedRoutes=this._parseRoutes()}setRouteNotFound(t){a._routes.ERROR_404=t}static navigate(t){window.history.pushState({},t,window.location.origin+t),a._resolveRoute(t)}static getParameters(){return a._routeParameters}listen(t=!1){this._useHashRouting=t,this._useHashRouting?window.addEventListener("hashchange",()=>{a._resolveRoute(this._getCurrentUrl())}):window.addEventListener("popstate",()=>{a._resolveRoute(this._getCurrentUrl())}),a._resolveRoute(this._getCurrentUrl())}_getCurrentUrl(){const t=(this._useHashRouting?window.location.hash.slice(1)||"/":window.location.pathname||"/").toLowerCase();return t.endsWith("/")&&t.length>1?t.slice(0,-1):t}_parseRoutes(){return Object.keys(a._routes).sort((t,e)=>e.length-t.length).map(t=>({url:new RegExp("^"+t.replace(/:[^\s/]+/g,"([\\w-]+)")+"$"),view:a._routes[t],pathname:t}))}static _getUrlParameters(t,e){const s={},i=t.pathname.split("/");let a=1;for(let t of i)t.startsWith(":")&&(s[t.substring(1)]=e[a],a++);return s}static _resolveRoute(t){let e=null;for(let s of a._parsedRoutes)if(e=t.match(s.url),e)return a._routeParameters=a._getUrlParameters(s,e),void i.render(a._routes[s.pathname]);if(!e){const e=a._routes.ERROR_404;if(!e)return void document.write(`ERROR 404: ${t} not found!`);i.render(e)}}}a._routes=null,a._parsedRoutes=null,a._routeParameters={};const n=async function(t,e,s={}){const i=await fetch(t,{method:"POST",body:JSON.stringify(e),headers:Object.assign({"Content-type":"application/json; charset=UTF-8"},s)});return{headers:i.headers,status:i.status,type:i.type,url:i.url,data:await i.json()}};class r{constructor(){this.playing=[]}play(t){let e=r.context.createBufferSource();e.buffer=t.buffer,e.connect(t.gainNode),e.loop=t.looping,t.node=e,t.node.start(0),this.playing.push(t)}stop(t){this.playing.includes(t)&&(t.node.stop(0),this.playing.splice(this.playing.indexOf(t),1))}pause(t){this.playing.includes(t)&&(t.node.disconnect(t.gainNode),this.playing.splice(this.playing.indexOf(t),1))}resume(t){this.playing.includes(t)||(t.node.connect(t.gainNode),this.playing.push(t))}isPlaying(t){return this.playing.includes(t)}static unlock(){try{let t=window.AudioContext||window.webkitAudioContext;if(r.context=new t,"suspended"==r.context.state){let t=function(){r.context.resume().then((function(){document.body.removeEventListener("touchstart",t),document.body.removeEventListener("touchend",t),document.body.removeEventListener("click",t)}))};document.body.addEventListener("touchstart",t),document.body.addEventListener("touchend",t),document.body.addEventListener("click",t)}}catch(t){console.log("WebAudio API is not supported!")}}}r.context=null;class o{constructor(t,e=gl.STATIC_DRAW){this.type=t,this.mode=e,this.buffer=gl.createBuffer()}bind(){gl.bindBuffer(this.type,this.buffer)}data(t){gl.bufferData(this.type,t,this.mode)}subData(t,e=0){gl.bufferSubData(this.type,e,t)}unbind(){gl.bindBuffer(this.type,null)}delete(){gl.deleteBuffer(this.buffer)}}class l extends o{constructor(t=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,t),super.bind(),super.data(new Float32Array([.5,.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(0),gl.vertexAttribPointer(0,3,gl.FLOAT,!1,0,0)}disable(){super.unbind(),gl.disableVertexAttribArray(0)}}class h{constructor(t=window.innerWidth,e=window.innerHeight){this.canvas=document.createElement("canvas"),this.canvas.id="SkylarkDisplay",this.canvas.width=t,this.canvas.height=e,this.options={alpha:!1},this.then=0,this.tolerance=.1}create(){if(window.gl=this.canvas.getContext("webgl",this.options),!gl)throw new Error("WebGL is not supported!");document.body.appendChild(this.canvas),gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),class{static init(){(new l).enable(),r.unlock()}}.init()}set(t){this.options=Object.assign(this.options,t)}resize(t=window.innerWidth,e=window.innerHeight){this.canvas.width=t,this.canvas.height=e,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight)}clear(t=0,e=0,s=0){gl.clear(gl.COLOR_BUFFER_BIT),gl.clearColor(t,e,s,1)}get width(){return this.canvas.width}get height(){return this.canvas.height}}class d{constructor(){this.data=new Float32Array(16),this.data[0]=1,this.data[5]=1,this.data[10]=1,this.data[15]=1}copy(t){this.data=t.data}identity(){this.data[0]=1,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=1,this.data[6]=0,this.data[7]=0,this.data[8]=0,this.data[9]=0,this.data[10]=1,this.data[11]=0,this.data[12]=0,this.data[13]=0,this.data[14]=0,this.data[15]=1}translate(t,e,s){this.data[12]=this.data[0]*t+this.data[4]*e+this.data[8]*s+this.data[12],this.data[13]=this.data[1]*t+this.data[5]*e+this.data[9]*s+this.data[13],this.data[14]=this.data[2]*t+this.data[6]*e+this.data[10]*s+this.data[14],this.data[15]=this.data[3]*t+this.data[7]*e+this.data[11]*s+this.data[15]}rotateX(t){let e=Math.sin(t),s=Math.cos(t);this.data[4]*=s+this.data[8]*e,this.data[5]*=s+this.data[9]*e,this.data[6]*=s+this.data[10]*e,this.data[7]*=s+this.data[11]*e,this.data[8]*=s-this.data[4]*e,this.data[9]*=s-this.data[5]*e,this.data[10]*=s-this.data[6]*e,this.data[11]*=s-this.data[7]*e}rotateY(t){let e=Math.sin(t),s=Math.cos(t);this.data[0]*=s-this.data[8]*e,this.data[1]*=s-this.data[9]*e,this.data[2]*=s-this.data[10]*e,this.data[3]*=s-this.data[11]*e,this.data[8]=this.data[0]*e+this.data[8]*s,this.data[9]=this.data[1]*e+this.data[9]*s,this.data[10]=this.data[2]*e+this.data[10]*s,this.data[11]=this.data[3]*e+this.data[11]*s}rotateZ(t){let e=Math.sin(t),s=Math.cos(t);this.data[0]*=s+this.data[4]*e,this.data[1]*=s+this.data[5]*e,this.data[2]*=s+this.data[6]*e,this.data[3]*=s+this.data[7]*e,this.data[4]*=s-this.data[0]*e,this.data[5]*=s-this.data[1]*e,this.data[6]*=s-this.data[2]*e,this.data[7]*=s-this.data[3]*e}scale(t,e,s){this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this.data[4]*=e,this.data[5]*=e,this.data[6]*=e,this.data[7]*=e,this.data[8]*=s,this.data[9]*=s,this.data[10]*=s,this.data[11]*=s}orthographic(t,e,s,i,a,n){let r=1/(t-e),o=1/(s-i),l=1/(a-n);this.data[0]=-2*r,this.data[5]=-2*o,this.data[10]=2*l,this.data[12]=(t+e)*r,this.data[13]=(i+s)*o,this.data[14]=(n+a)*l}lookAt(t,e,s){Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6&&Math.abs(t.z-e.z)<1e-6&&this.identity();let i=t.x-e.x,a=t.y-e.y,n=t.z-e.z,r=1/Math.hypot(i,a,n);i*=r,a*=r,n*=r;let o=s.y*n-s.z*a,l=s.z*i-s.x*n,h=s.x*a-s.y*i;r=Math.hypot(o,l,h),r?(r=1/r,o*=r,l*=r,h*=r):(o=0,l=0,h=0);let d=a*h-n*l,c=n*o-i*h,u=i*l-a*o;r=Math.hypot(d,c,u),r?(r=1/r,d*=r,c*=r,u*=r):(d=0,c=0,u=0),this.data[0]=o,this.data[1]=d,this.data[2]=i,this.data[4]=l,this.data[5]=c,this.data[6]=a,this.data[8]=h,this.data[9]=u,this.data[10]=n,this.data[12]=-(o*t.x+l*t.y+h*t.z),this.data[13]=-(d*t.x+c*t.y+u*t.z),this.data[14]=-(i*t.x+a*t.y+n*t.z)}static invert(t){let e=t.data,s=new d,i=e[0],a=e[1],n=e[2],r=e[3],o=e[4],l=e[5],h=e[6],c=e[7],u=e[8],g=e[9],p=e[10],m=e[11],w=e[12],f=e[13],y=e[14],b=e[15],E=i*l-a*o,v=i*h-n*o,x=i*c-r*o,_=a*h-n*l,T=a*c-r*l,A=n*c-r*h,R=u*f-g*w,S=u*y-p*w,k=u*b-m*w,D=g*y-p*f,P=g*b-m*f,L=p*b-m*y,I=E*L-v*P+x*D+_*k-T*S+A*R;return I?(I=1/I,s.data[0]=(l*L-h*P+c*D)*I,s.data[1]=(n*P-a*L-r*D)*I,s.data[2]=(f*A-y*T+b*_)*I,s.data[3]=(p*T-g*A-m*_)*I,s.data[4]=(h*k-o*L-c*S)*I,s.data[5]=(i*L-n*k+r*S)*I,s.data[6]=(y*x-w*A-b*v)*I,s.data[7]=(u*A-p*x+m*v)*I,s.data[8]=(o*P-l*k+c*R)*I,s.data[9]=(a*k-i*P-r*R)*I,s.data[10]=(w*T-f*x+b*E)*I,s.data[11]=(g*x-u*T-m*E)*I,s.data[12]=(l*S-o*D-h*R)*I,s.data[13]=(i*D-a*S+n*R)*I,s.data[14]=(f*v-w*_-y*E)*I,s.data[15]=(u*_-g*v+p*E)*I,s):null}static multiply(t,e){let s=t.data,i=e.data,a=new d,n=s[0],r=s[1],o=s[2],l=s[3],h=s[4],c=s[5],u=s[6],g=s[7],p=s[8],m=s[9],w=s[10],f=s[11],y=s[12],b=s[13],E=s[14],v=s[15],x=i[0],_=i[1],T=i[2],A=i[3];return a.data[0]=x*n+_*h+T*p+A*y,a.data[1]=x*r+_*c+T*m+A*b,a.data[2]=x*o+_*u+T*w+A*E,a.data[3]=x*l+_*g+T*f+A*v,x=i[4],_=i[5],T=i[6],A=i[7],a.data[4]=x*n+_*h+T*p+A*y,a.data[5]=x*r+_*c+T*m+A*b,a.data[6]=x*o+_*u+T*w+A*E,a.data[7]=x*l+_*g+T*f+A*v,x=i[8],_=i[9],T=i[10],A=i[11],a.data[8]=x*n+_*h+T*p+A*y,a.data[9]=x*r+_*c+T*m+A*b,a.data[10]=x*o+_*u+T*w+A*E,a.data[11]=x*l+_*g+T*f+A*v,x=i[12],_=i[13],T=i[14],A=i[15],a.data[12]=x*n+_*h+T*p+A*y,a.data[13]=x*r+_*c+T*m+A*b,a.data[14]=x*o+_*u+T*w+A*E,a.data[15]=x*l+_*g+T*f+A*v,a}}class c{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){this.x=t,this.y=e}transformMat4(t){let e=this.x,s=this.y;this.x=t.data[0]*e+t.data[4]*s+t.data[12],this.y=t.data[1]*e+t.data[5]*s+t.data[13]}}class u{constructor(t=0,e=0,s=0){this.x=t,this.y=e,this.z=s}set(t,e,s){this.x=t,this.y=e,this.z=s}}class g{constructor(t=gl.canvas.width,e=gl.canvas.height,s=!0){this.width=t,this.height=e,this.position=new c(0,0),this.viewMatrix=new d,this.projectionMatrix=new d,this.combined=new d,s?this.projectionMatrix.orthographic(-this.width/2,this.width/2,-this.height/2,this.height/2,-1,1e3):this.projectionMatrix.orthographic(0,this.width,0,this.height,-1,1e3),this.update()}update(){this.viewMatrix.lookAt(new u(this.position.x,this.position.y,10),new u(this.position.x,this.position.y,0),new u(0,1,0)),this.combined=d.multiply(this.projectionMatrix,this.viewMatrix)}setPosition(t,e){this.position.set(t,e)}inView(t,e){return t>=this.position.x&&t<=this.position.x+this.width&&e>=this.position.y&&e<=this.position.y+this.height}unproject(t,e){let s=d.invert(this.combined),i=new c(2*t/gl.canvas.width-1,-2*e/gl.canvas.height+1);return i.transformMat4(s),i}}class p{constructor(){this.program=gl.createProgram()}compile(t,e){let s=this.loadShader(t,gl.VERTEX_SHADER),i=this.loadShader(e,gl.FRAGMENT_SHADER);if(gl.attachShader(this.program,s),gl.attachShader(this.program,i),this.bindAttributes(),gl.linkProgram(this.program),gl.validateProgram(this.program),!gl.getProgramParameter(this.program,gl.LINK_STATUS)){let t=gl.getProgramInfoLog(this.program);throw gl.deleteProgram(this.program),gl.deleteShader(s),gl.delteteShader(i),new Error("SHADER_PROGRAM: "+t)}}start(){gl.useProgram(this.program)}stop(){gl.useProgram(null)}bindAttribute(t,e){gl.bindAttribLocation(this.program,t,e)}bindAttributes(){this.bindAttribute(0,"a_position"),this.bindAttribute(1,"a_texCoords")}getAttributeLocation(t){return gl.getAttribLocation(this.program,t)}getUniformLocation(t){return gl.getUniformLocation(this.program,t)}extractUniforms(){let t={},e=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);for(let s=0;s<e;s++){let e=gl.getActiveUniform(this.program,s),i=e.name.replace("[0]",""),a=this.getUniformLocation(i);t[i]={name:i,location:a,type:e.type}}return t}loadFloat(t,e){gl.uniform1f(t,e)}loadVector2(t,e){gl.uniform2f(t,e.x,e.y)}loadVector3(t,e){gl.uniform3f(t,e.x,e.y,e.z)}loadMatrix4(t,e){gl.uniformMatrix4fv(t,!1,e.data)}loadShader(t,e){let s=gl.createShader(e);if(gl.shaderSource(s,t),gl.compileShader(s),!gl.getShaderParameter(s,gl.COMPILE_STATUS)){let t;e==gl.VERTEX_SHADER?t="VERTEX_SHADER":e==gl.FRAGMENT_SHADER&&(t="FRAGMENT_SHADER");let i=gl.getShaderInfoLog(s);throw gl.deleteShader(s),new Error(`${t}: ${i}`)}return s}}class m{constructor(t,e){this.id=Math.random(),this.shader=new p,this.shader.compile(t,e),this.uniforms=this.shader.extractUniforms()}use(){m.currentID!=this.id&&(m.currentID=this.id,this.shader.start()),this.prepare()}prepare(){}set(t,e){let s=this.uniforms[t];switch(s.type){case gl.FLOAT:this.shader.loadFloat(s.location,e);break;case gl.FLOAT_VEC2:this.shader.loadVector2(s.location,e);break;case gl.FLOAT_VEC3:this.shader.loadVector3(s.location,e);break;case gl.FLOAT_MAT4:this.shader.loadMatrix4(s.location,e);break;default:throw new Error(e+" is not a compatible value type!")}}}m.currentID=0;class w extends o{constructor(t=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,t),super.bind(),super.data(new Float32Array([1,1,0,1,1,0,0,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(1),gl.vertexAttribPointer(1,2,gl.FLOAT,!1,0,0)}disable(){gl.disableVertexAttribArray(1),super.unbind()}}const f="\n    attribute vec3 a_position;\n    attribute vec2 a_texCoords;\n\n    varying vec2 v_texCoords;\n\n    uniform mat4 u_model;\n    uniform mat4 u_viewProjection;\n\n    void main(void) {\n        gl_Position = u_viewProjection * u_model * vec4(a_position, 1.0);\n        v_texCoords = a_texCoords;\n    }\n",y="\n    precision mediump float;\n\n    varying vec2 v_texCoords;\n\n    uniform sampler2D u_image;\n    uniform vec3 u_color;\n\n    void main(void) {\n        \n        gl_FragColor = texture2D(u_image, v_texCoords) * vec4(u_color, 1.0);\n    }\n";class b extends m{constructor(t){super(f,y),this.image=t,this.textureID=t.textureID,this.tint=new u(1,1,1),this.textureBuffer=new w}prepare(){this.textureBuffer.enable(),gl.bindTexture(gl.TEXTURE_2D,this.textureID),super.set("u_color",this.tint)}setTint(t,e,s){this.tint.set(t/255,e/255,s/255)}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}}class E extends m{constructor(t){super(f,y),this.image=t,this.textureID=t.textureID,this.tint=new u(1,1,1),this.region=[1,1,0,1,1,0,0,0],this.regionX=0,this.regionY=0,this.regionWidth=this.image.naturalWidth,this.regionHeight=this.image.naturalHeight,this.textureBuffer=new w(gl.DYNAMIC_DRAW)}prepare(){this.textureBuffer.enable(),gl.bindTexture(gl.TEXTURE_2D,this.textureID),super.set("u_color",this.tint)}setTint(t,e,s){this.tint.set(t/255,e/255,s/255)}setRegion(t,e,s,i){let a={};a.left=t/this.image.naturalWidth,a.right=(t+s)/this.image.naturalWidth,a.bottom=e/this.image.naturalHeight,a.top=(e+i)/this.image.naturalHeight,this.region=[a.right,a.top,a.left,a.top,a.right,a.bottom,a.left,a.bottom],this.regionX=t,this.regionY=e,this.regionWidth=s,this.regionHeight=i,this.textureBuffer.bind(),this.textureBuffer.subData(new Float32Array(this.region))}setRegionUV(t,e,s,i){this.region=[e,i,t,i,e,s,t,s]}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}}class v extends E{constructor(t){super(t),this.animationType=0,this.updateInterval=1,this.currentAdvance=1,this.currentFrame=0,this.currentTick=0}prepare(){super.prepare(),this.update()}setSequence(t,e,s,i,a,n=0){this.frameX=t,this.frameY=e,this.frameWidth=s,this.frameHeight=i,this.widthPadding=n,this.frameCount=a,this.updateFrame()}setSpeed(t){this.updateInterval=t}update(){this.currentTick++,this.currentTick>=this.updateInterval&&(this.currentTick=0,this.currentFrame+=this.currentAdvance,this.currentFrame>=0&&this.currentFrame<this.frameCount?this.updateFrame():(this.currentTick=0,this.currentFrame=0))}updateFrame(){let t=this.frameX+this.currentFrame*(this.frameWidth+this.widthPadding);super.setRegion(t,this.frameY,this.frameWidth,this.frameHeight)}}class x{constructor(){this.origin=new c(0,0),this.position=new c(0,0),this.scale=new c(1,1),this.rotationInRadians=0,this.matrix=new d}setRotation(t){for(this.rotationInRadians=t;this.rotationInRadians>2*Math.PI;)this.rotationInRadians-=2*Math.PI}update(){this.matrix.identity(),this.matrix.translate(this.x+this.origin.x,this.y+this.origin.y,0),this.matrix.rotateZ(this.rotationInRadians),this.matrix.scale(this.width,this.height,1)}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}get width(){return this.scale.x}set width(t){this.scale.x=t}get height(){return this.scale.y}set height(t){this.scale.y=t}}class _{constructor(t){this.material=t,this.transform=new x,this.setPosition(0,0),this.setSize(100,100)}draw(t){this.material.use(),this.transform.update(),this.material.set("u_model",this.transform.matrix),this.material.set("u_viewProjection",t.combined),gl.drawArrays(gl.TRIANGLE_STRIP,0,4)}setMaterial(t){this.materia=t}setOrigin(t,e){this.transform.origin.set(t,e)}setPosition(t,e){this.transform.position.set(t,e)}setSize(t,e){this.transform.scale.set(t,e)}setRotation(t){this.transform.setRotation(t)}}class T{static use(){}static update(){}}class A extends T{static use(){window.addEventListener("keydown",t=>{t.preventDefault(),A.keysDown[t.key]=!0}),window.addEventListener("keyup",t=>{t.preventDefault(),A.keysDown[t.key]=!1});for(let t in R)A.keysDown[R[t]]=!1,A.previousKeyState[R[t]]=!1,A.keysPressed[R[t]]=!1}static update(){for(let t in R)A.keysPressed[R[t]]=!A.previousKeyState[R[t]]&&A.keysDown[R[t]],A.previousKeyState[R[t]]=A.keysDown[R[t]]}static isKeyDown(t){return A.keysDown[t]}static isKeyPressed(t){return A.keysPressed[t]}}A.keysDown={},A.keysPressed={},A.previousKeyState={};const R=Object.freeze({LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",SPACE:" ",TAB:"Tab",SHIFT:"Shift",BACKQUOTE:"`",ESCAPE:"Escape",CONTROL:"Control",META:"meta",BACKSPACE:"Backspace",ENTER:"Enter",SLASH:"/",ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z"});class S extends T{static use(){window.addEventListener("mousedown",t=>{t.preventDefault(),S.buttonsDown[t.button]=!0}),window.addEventListener("mouseup",t=>{t.preventDefault(),S.buttonsDown[t.button]=!1}),window.addEventListener("mousemove",t=>{t.preventDefault(),S.x=t.clientX,S.y=t.clientY});for(let t=0;t<3;t++)S.buttonsDown[t]=!1,S.buttonsPressed[t]=!1,S.previousButtonState[t]=!1}static update(){for(let t=0;t<3;t++)S.buttonsPressed[t]=!S.previousButtonState[t]&&S.buttonsDown[t],S.previousButtonState[t]=S.buttonsDown[t]}static isButtonDown(t){return S.buttonsDown[t]}static isButtonPressed(t){return S.buttonsPressed[t]}}S.buttonsDown={},S.buttonsPressed={},S.previousButtonState={},S.x=-1,S.y=-1;const k=Object.freeze({LEFT:0,MIDDLE:1,RIGHT:2});class D{static load(t="string",e="Object"){throw new Error(`[Unimplemented Function]: LoaderInterface.load(${t}, ${e})`)}static unload(t,e){delete e[t]}static isLoaded(t,e){return t in e}}class P extends D{static load(t,e){if(super.isLoaded(t,e))return;let s=new Image;return new Promise((function(i,a){s.addEventListener("load",(function(){let a=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,s),gl.bindTexture(gl.TEXTURE_2D,null),s.textureID=a,e[t]=s,i()})),s.addEventListener("error",(function(){a(new Error("Failed to load asset: "+t))})),s.src=t}))}static unload(t,e){gl.deleteTexture(e[t].textureID),super.unload(t,e)}}class L extends D{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(s,i){fetch(t).then(t=>t.json()).then(i=>{e[t]=i,s()}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}}class I extends D{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(s,i){fetch(t).then(t=>t.text()).then(i=>{e[t]=i,s()}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}}class N extends D{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(s,i){fetch(t).then(t=>t.arrayBuffer()).then(i=>{r.context.decodeAudioData(i,(function(i){e[t]=i,s()}))}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}}class M extends D{static load(t,e){if(!super.isLoaded(t,e))return new Promise((function(s,i){fetch(t).then(t=>t.json()).then(a=>{M.loadTilesets(a,e,t,s,i)}).catch(()=>{i(new Error("Failed to load asset: "+t))})}))}static unload(t,e){let s=e[t].data.tilesets;for(let t=0;t<s.length;t++)gl.deleteTexture(e[s[t].image].textureID);super.unload(t,e)}static loadTilesets(t,e,s,i,a){let n=t.tilesets.length,r=0;for(let o=0;o<n;o++){let l=new Image;l.addEventListener("load",(function(){e[t.tilesets[o].image]=l,r++,r==n&&M.splitTiles(t,e,s,i,a)})),l.addEventListener("error",(function(){a(new Error("Failed to load asset: "+s))})),l.src=t.tilesets[o].image}}static splitTiles(t,e,s,i,a){let n=[],r=t.tilesets.length;for(let s=0;s<r;s++)n.push(e[t.tilesets[s].image]);let o=[];for(let e=0;e<n.length;e++){let s=n[e].width/t.tilewidth,i=n[e].height/t.tileheight;for(let a=0;a<i;a++)for(let i=0;i<s;i++){let s=document.createElement("canvas"),r=s.getContext("2d");r.width=t.tilewidth,r.height=t.tileheight;let l=i*t.tilewidth,h=a*t.tileheight;r.drawImage(n[e],-l,-h),o.push(s)}}M.predraw(t,e,s,n,o,i,a)}static predraw(t,e,s,i,a,n,r){let o=document.createElement("canvas");o.width=t.width*t.tilewidth,o.height=t.height*t.tileheight;let l=o.getContext("2d");for(let e=0;e<t.layers.length;e++){let s=0,i=0;if("tilelayer"==t.layers[e].type)for(let n=0;n<t.layers[e].data.length;n++){if(n%t.width==0&&0!=n&&(i+=t.tileheight,s=0),0!=t.layers[e].data[n]){let r=a[t.layers[e].data[n]];l.drawImage(r,s,i)}s+=t.tilewidth}}let h=new Image;h.addEventListener("load",(function(){let a=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,h),gl.bindTexture(gl.TEXTURE_2D,null),h.textureID=a,e[s]={data:t,tilesets:i,image:h},n()})),h.addEventListener("error",(function(){r(new Error("Failed to load asset: "+s))})),h.src=o.toDataURL("image/png")}}class F{constructor(){this.queue=[],this.cache={},this.loaderTypes={png:P,jpg:P,jpeg:P,json:L,tiled:M,glsl:I,vert:I,frag:I,mp3:N,wav:N,ogg:N}}get(t){return this.cache[t]}add(t,e){if(Array.isArray(t))for(let s of t)this.queue.push(this.getLoadFunction(s,e));else this.queue.push(this.getLoadFunction(t,e))}load(t,e){if(Array.isArray(t)){let s=[];for(let i of t)s.push(this.getLoaderFunction(i,e));return Promise.all(s)}return this.getLoadFunction(t,e)}loadAssets(){return Promise.all(this.queue)}unload(t,e){this.loaderTypes[this.getType(t,e)].unload(t,this.cache)}empty(){this.queue=[]}clear(){this.queue=[];for(let t of Object.keys(this.cache))this.loaderTypes[this.getType(t)].unload(t,this.cache)}registerType(t,e){this.loaderTypes[t]?console.error(t+" already a registed asset type!"):this.loaderTypes[t]=e}getLoadFunction(t,e){let s=this.getType(t,e);if(this.loaderTypes.hasOwnProperty(s))return this.loaderTypes[s].load(t,this.cache);throw new Error("Unknown asset type: "+s)}getType(t,e){if(e)return e;{let e=t.split(".");return e[e.length-1]}}}Object.freeze({TEXTURE:"png",JSON:"json",SHADER:"glsl",AUDIO:"mp3",TILEDMAP:"tiled"});class U{constructor(t,e,s,i){this.x=t,this.y=e,this.width=s,this.height=i,this.right=this.x+this.width,this.bottom=this.y+this.height}setPosition(t,e){this.x=t,this.y=e}setSize(t,e){this.width=t,this.height=e}overlaps(t){return this.x<t.right&&this.right>t.x&&this.y<t.bottom&&this.bottom>t.y}within(t){return t.x>=this.x&&t.right<=this.right&&t.y<=this.y&&t.bottom>=this.bottom}contains(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom}}class C{constructor(){this.active=!1,this.FPS=60,this.MPF=1e3/this.FPS,this.lastTime=0,this.lagTime=0,this.currentTime=0,this.elapsedTime=0}async create(){}render(){}update(){}dispose(){}static async setScreen(t){null!=C.currentScreen&&(C.currentScreen.active=!1),C.currentScreen=t,t.previousTime=performance.now(),t.active=!0,await t.create(),requestAnimationFrame(t.renderLoop.bind(t))}renderGUI(t){try{document.getElementById("skylark-gui").innerHTML=t}catch{throw new Error('Element with id: "skylark-gui" not found!')}}renderLoop(){if(this.active){for(requestAnimationFrame(this.renderLoop.bind(this)),this.currentTime=performance.now(),this.elapsedTime=this.currentTime-this.lastTime,this.lastTime=this.currentTime,this.lagTime+=this.elapsedTime;this.lagTime>=this.MPF&&this.active;)this.update(),this.lagTime-=this.MPF;this.render()}else this.dispose()}}C.currentScreen=null;class B{static on(t,e){B.events[t]=e,window.addEventListener(t,e)}static remove(t,e){delete B.events[t],window.removeEventListener(t,e)}static emit(t){B.events[t]()}static isPortrait(){return window.innerHeight>window.innerWidth}static isLandscape(){return window.innerWidth>window.innerHeight}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static toggleFullscreen(){document.fullscreenEnabled&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen())}static togglePointerLock(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.body.requestPointerLock()}}B.events={};class O extends _{constructor(t,e,s,i,a){super(a),this.x=t,this.y=e,super.setPosition(t,e),this.rect=new U(t,e,s,i),this.width=s,this.height=i,this.setSize(s,i),this.direction={up:!1,down:!1,left:!1,right:!1}}setAnimation(t){super.setMaterial(t)}move(t,e){this.x=t,this.y=e,super.setPosition(t,e)}}class H extends _{constructor(t,e,s,i,a,n){super(n),this.x=t,this.y=e,this.width=s,this.height=i,super.setPosition(this.x,this.y),super.setSize(this.width,this.height),this.rect=new U(this.x-this.width/2,this.y-this.height/2,this.width,this.height),this.type=a}}class W{static findSector(t,e,s){for(let i of t.world.map){let a=new H(i.x,i.y,96,96,i.type,t.materials[i.tile]);if(a.rect.contains(e,s))return a}}static collidesWithObject(t,e,s){if(game.world){t.rect.x+=e,t.rect.y+=s;for(let e of game.world.map)if("wall"==e.type&&e.rect.collides(t.rect))return!0;return!1}}static getSurrounding(t,e,s,i,a){return W.findSector(t,e,s+a)?"top":"core"}}class X extends WebSocket{constructor(t,e,s){super(t),this.email=e,this.password=s}trackOpen(t){super.onopen=()=>{this.send({type:"connect",email:this.email,password:this.password})}}trackMessage(t){super.onmessage=e=>{switch((e=JSON.parse(e.data)).type){case"status":console.log(e),e.login&&this.send({type:"loadPlayers"});break;case"setWorld":t.world=e.world,console.log(t.world);break;case"setPlayers":t.players=[];for(let s in e.players){let i=e.players[s],a=new O(i.x,i.y,96,96,t.animations.base_idle_right);a.id=i.id,t.players.push(a)}break;case"updatePlayer":t.players.find(t=>t.id==e.player.id).move(e.player.x,e.player.y);break;case"setID":t.playerID=e.id;break;case"chatMessage":document.getElementById("chatBox").state.messages+=e.message+";"}}}trackError(){super.onerror=t=>{if(t)throw t}}trackClose(){super.onclose=()=>{window.location="/"}}send(t){t=JSON.stringify(t),super.send(t)}}class j extends E{constructor(t){super(t)}setRegion(t,e){super.setRegion(t,e,32,32)}}class V{static windowKeys(t,e){let s=t.players.find(e=>e.id==t.playerID);s=t.players.find(e=>e.id==t.playerID),document.activeElement!=document.getElementById("chatBox")&&(A.isKeyDown(R.W)&&e.send({type:"move",direction:"up"}),A.isKeyDown(R.S)&&e.send({type:"move",direction:"down"}),A.isKeyDown(R.A)&&e.send({type:"move",direction:"left"}),A.isKeyDown(R.D)&&e.send({type:"move",direction:"right"}))}static windowClick(t,e){let s=t.camera.unproject(S.x,S.y);S.isButtonDown(k.LEFT)&&e.send({type:"click",button:"left",pos:{x:s.x,y:s.y}}),S.isButtonDown(k.RIGHT)&&e.send({type:"click",button:"right",pos:{x:s.x,y:s.y}})}}class G{static setup(t){t.display=new h(window.innerWidth,window.innerHeight),t.display.create(),t.loader=new F,t.width=1280,t.height=720,t.camera=new g(t.width,t.height),B.on("resize",()=>{t.display.resize(window.innerWidth,window.innerHeight)}),window.addEventListener("contextmenu",t=>{t.preventDefault()}),document.getElementById("chatBox").style.display="block"}static async loadAssets(t){t.loader.add("assets/Base_Sprite_Walk.png"),t.loader.add("assets/tileset.png"),t.loader.add("assets/background.png"),await t.loader.loadAssets(),t.assets.base_walk=t.loader.get("assets/Base_Sprite_Walk.png"),t.assets.tileset=t.loader.get("assets/tileset.png"),t.assets.background=t.loader.get("assets/background.png"),G.setAnimations(t),G.setMaterials(t)}static setAnimations(t){t.animations.base_idle_right=new v(t.assets.base_walk),t.animations.base_idle_right.setSequence(144,0,48,48,1),t.animations.base_walk_right=new v(t.assets.base_walk),t.animations.base_walk_right.setSequence(0,0,48,48,3),t.animations.base_walk_right.setSpeed(10),t.animations.base_walk_left=new v(t.assets.base_walk),t.animations.base_walk_left.setSequence(192,0,48,48,3)}static setMaterials(t){t.train=new j(t.assets.tileset),t.materials.tileset=new b(t.assets.tileset),t.materials.background=new b(t.assets.background)}}class z{static getTile(t,e){let s;switch(t){case"dirt":s=z.getDirt(e);break;case"cobble":s=z.getCobble(e)}return s}static getDirt(t){switch(t){case"top":return{x:0,y:0};case"core":return{x:0,y:32}}}static getCobble(t){switch(t){case"top":return{x:32,y:0};case"core":return{x:32,y:32}}}}class q extends C{constructor(t,e,s){super(),this.game={animations:{},assets:{},id:1,materials:{},players:[],textureRegion:{}},this.ws=new X(t,e,s),this.ws.trackOpen(),this.ws.trackMessage(this.game),this.ws.trackError(),this.ws.trackClose()}create(){G.setup(this.game),G.loadAssets(this.game),A.use(),S.use()}update(){A.update(),S.update(),V.windowKeys(this.game,this.ws),V.windowClick(this.game,this.ws);let t=this.game.players.find(t=>t.id==this.game.playerID);t&&(this.game.camera.setPosition(t.x,t.y),this.game.camera.update())}render(){if(this.game.display.clear(),this.game.world)for(let t in this.game.world.map){let e=this.game.world.map[t],s=W.getSurrounding(this.game,e.x,e.y,96,96),{x:i,y:a}=z.getTile(e.tile,s);this.game.train.setRegion(i,a),new H(e.x,e.y,96,96,e.type,this.game.train).draw(this.game.camera)}for(let t=0;t<this.game.players.length;t++)this.game.players[t].draw(this.game.camera)}}s.register("login-screen",class extends s{constructor(){super(),this.state.status=""}render(){return`\n        <style>\n            form {\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                margin: auto;\n                height: 50%;\n                position: absolute;\n                top: 45%;\n                left: 25%;\n                color: white;\n            }\n            \n            .menu {\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                margin: auto;\n                height: 50%;\n                position: absolute;\n                top: 45%;\n                left: 25%;\n                color: white;\n            }\n            \n            form * {\n                background-color: transparent;\n                height: 10%;\n                color: white;\n            }\n            \n            #status {\n                width: 100%;\n                height: auto;\n            }\n            \n            #background {\n                width: 100%;\n                height: 10%;\n                margin: auto;\n            }\n            \n            #chat {\n                color: white;\n                position: absolute;\n                bottom: 2.5%;\n                left: 5%;\n                height: 30%;\n                width: 35%;\n                background-color: rgba(240, 248, 255, 0.05);\n                overflow-x: none;\n                overflow-y: scroll;\n            }\n            \n            #chatMessage {\n                height: 2.5%;\n                position: absolute;\n                left: 5%;\n                bottom: 0%;\n                width: 35%;\n                background-color: rgba(240, 248, 255, 0.05);\n                overflow-x: scroll;\n                overflow-y: none;\n                color: white;\n            }\n            </style>\n\n            <img src="assets/logo.png" id="background" />\n            <form @submit="validateAccount">\n                <input id="email" type="email" placeholder="Email" name="email" for="email"/>\n                <input id="password" type="password" placeholder="Password" name="password" for="password" />\n                <button type="submit">Connect</button>\n                <span>${this.state.status}</span>\n            </form>\n        `}async validateAccount(t){t.preventDefault();let e=t.path[0][0].value.toLowerCase(),s=t.path[0][1].value;const i=await n("/login",{email:e,password:s});if(console.log(i),201==i.status){this.style.display="none",C.setScreen(new q(i.data.socket,e,s));let t=new Audio("assets/main.mp4");t.loop=!0,t.play()}else this.state.status=i.data.reason}}),s.register("chat-window",class extends s{constructor(){super(),this.state.messages="",this.state.value=""}render(){return`\n        <style>\n            :host {\n                background-color: rgba(255, 255, 255, 0.5);\n                width: 25%;\n                height: 30%;\n                position: absolute;\n                bottom: 0%;\n                left: 0%;\n            }\n\n            #messages{\n                position: absolute;\n                bottom: 10%;\n                left: 0%;\n                width: 99.5%;\n                height: 90%;\n            }\n\n            #chatInput{\n                position: absolute;\n                bottom: 0%;\n                left: 0%;\n                height: 10%;\n                width: 99.5%;\n                background-color: transparent;\n                border: 1px solid black;\n            }\n        </style>\n\n        <form @submit="sendMessage">\n            <div id="messages" class="chatBoxElement">\n            ${this._updateMessages(this.state.messages)}\n            </div>\n            <input id="chatInput" value="${this._updateValue(this.state.value)}" class="chatBoxElement" placeholder="Send Message"/>\n        </form>\n        `}sendMessage(t){t.preventDefault();let e=t.path[0][0];ws.send({type:"chatMessage",message:e.value}),e.value=""}_updateMessages(t){let e="";const s=t.split(/;/g);for(let t of s)e+=`<span>${t}</span><br>`;return e}_updateValue(t){return t}});s.register("input-verification",class extends s{constructor(){super(),this.state.response=""}render(){return`\n            <form @submit="sendUsername">\n                <input placeholder="Input username here" />\n            </form>\n\n            <span style="color: white;">${this.state.response}</span>\n        `}async sendUsername(t){t.preventDefault();const{token:e}=a.getParameters();(await n("/verify",{token:e,username:t.path[0][0].value})).data.then(t=>{this.state.response=t.status})}});new a({"/":new class extends i{render(){return'\n            <login-screen id="loginScreen"></login-screen>\n            <chat-window id="chatBox"></chat-window>\n        '}didLoad(){document.getElementById("chatBox").style.display="none"}}(document.getElementById("app")),"/verify/:token":new class extends i{render(){return"\n            <input-verification></input-verification>\n        "}}(document.getElementById("app"))}).listen()}();