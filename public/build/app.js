!function(){"use strict";class e{set(e){this.prototype=Object.assign(this,e)}static create(t){return new Proxy(new e,{set:(e,n,i)=>"prototype"==n||e[n]==i||(e[n]?(e[n]=i,t&&t(n,i),!0):(e[n]=i,!0))})}}class t{constructor(t="app"){this._element=document.getElementById(t),this._params={},this.state=e.create(()=>{this._element.innerHTML=this.render(this._params),this.didLoad(this._params)})}addStyle(e){const t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}setElement(e){this._element=e}setElementById(e){this._element=document.getElementById(e)}load(){}render(){}didLoad(){}static async render(e,t={}){e._params=t,await e.load(t),e._element.innerHTML=await e.render(t),await e.didLoad(t)}}class n{constructor(){this.playing=[]}play(e){let t=n.context.createBufferSource();t.buffer=e.buffer,t.connect(e.gainNode),t.loop=e.looping,e.node=t,e.node.start(0),this.playing.push(e)}stop(e){this.playing.includes(e)&&(e.node.stop(0),this.playing.splice(this.playing.indexOf(e),1))}pause(e){this.playing.includes(e)&&(e.node.disconnect(e.gainNode),this.playing.splice(this.playing.indexOf(e),1))}resume(e){this.playing.includes(e)||(e.node.connect(e.gainNode),this.playing.push(e))}isPlaying(e){return this.playing.includes(e)}static unlock(){try{let e=window.AudioContext||window.webkitAudioContext;if(n.context=new e,"suspended"==n.context.state){let e=function(){n.context.resume().then((function(){document.body.removeEventListener("touchstart",e),document.body.removeEventListener("touchend",e),document.body.removeEventListener("click",e)}))};document.body.addEventListener("touchstart",e),document.body.addEventListener("touchend",e),document.body.addEventListener("click",e)}}catch(e){console.log("WebAudio API is not supported!")}}}n.context=null;class i extends class{constructor(e,t=gl.STATIC_DRAW){this.type=e,this.mode=t,this.buffer=gl.createBuffer()}bind(){gl.bindBuffer(this.type,this.buffer)}data(e){gl.bufferData(this.type,e,this.mode)}subData(e,t=0){gl.bufferSubData(this.type,t,e)}unbind(){gl.bindBuffer(this.type,null)}delete(){gl.deleteBuffer(this.buffer)}}{constructor(e=gl.STATIC_DRAW){super(gl.ARRAY_BUFFER,e),super.bind(),super.data(new Float32Array([.5,.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0])),super.unbind()}enable(){super.bind(),gl.enableVertexAttribArray(0),gl.vertexAttribPointer(0,3,gl.FLOAT,!1,0,0)}disable(){super.unbind(),gl.disableVertexAttribArray(0)}}class s{constructor(e=window.innerWidth,t=window.innerHeight){this.canvas=document.createElement("canvas"),this.canvas.id="SkylarkDisplay",this.canvas.width=e,this.canvas.height=t,this.options={alpha:!1},this.then=0,this.tolerance=.1}create(){if(window.gl=this.canvas.getContext("webgl",this.options),!gl)throw new Error("WebGL is not supported!");document.body.appendChild(this.canvas),gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0),class{static init(){(new i).enable(),n.unlock()}}.init()}set(e){this.options=Object.assign(this.options,e)}resize(e=window.innerWidth,t=window.innerHeight){this.canvas.width=e,this.canvas.height=t,gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight)}clear(e=0,t=0,n=0){gl.clear(gl.COLOR_BUFFER_BIT),gl.clearColor(e,t,n,1)}get width(){return this.canvas.width}get height(){return this.canvas.height}}Object.freeze({LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",SPACE:" ",TAB:"Tab",SHIFT:"Shift",BACKQUOTE:"`",ESCAPE:"Escape",CONTROL:"Control",META:"meta",BACKSPACE:"Backspace",ENTER:"Enter",SLASH:"/",ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z"}),Object.freeze({LEFT:0,MIDDLE:1,RIGHT:2});class r{static load(e="string",t="Object"){throw new Error(`[Unimplemented Function]: LoaderInterface.load(${e}, ${t})`)}static unload(e,t){delete t[e]}static isLoaded(e,t){return e in t}}class a extends r{static load(e,t){if(super.isLoaded(e,t))return;let n=new Image;return new Promise((function(i,s){n.addEventListener("load",(function(){let s=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,n),gl.bindTexture(gl.TEXTURE_2D,null),n.textureID=s,t[e]=n,i()})),n.addEventListener("error",(function(){s(new Error(`Failed to load asset: ${e}`))})),n.src=e}))}static unload(e,t){gl.deleteTexture(t[e].textureID),super.unload(e,t)}}class o extends r{static load(e,t){if(!super.isLoaded(e,t))return new Promise((function(n,i){fetch(e).then(e=>e.json()).then(i=>{t[e]=i,n()}).catch(()=>{i(new Error(`Failed to load asset: ${e}`))})}))}}class l extends r{static load(e,t){if(!super.isLoaded(e,t))return new Promise((function(n,i){fetch(e).then(e=>e.text()).then(i=>{t[e]=i,n()}).catch(()=>{i(new Error(`Failed to load asset: ${e}`))})}))}}class d extends r{static load(e,t){if(!super.isLoaded(e,t))return new Promise((function(i,s){fetch(e).then(e=>e.arrayBuffer()).then(s=>{n.context.decodeAudioData(s,(function(n){t[e]=n,i()}))}).catch(()=>{s(new Error(`Failed to load asset: ${e}`))})}))}}class c extends r{static load(e,t){if(!super.isLoaded(e,t))return new Promise((function(n,i){fetch(e).then(e=>e.json()).then(s=>{c.loadTilesets(s,t,e,n,i)}).catch(()=>{i(new Error(`Failed to load asset: ${e}`))})}))}static unload(e,t){let n=t[e].data.tilesets;for(let e=0;e<n.length;e++)gl.deleteTexture(t[n[e].image].textureID);super.unload(e,t)}static loadTilesets(e,t,n,i,s){let r=e.tilesets.length,a=0;for(let o=0;o<r;o++){let l=new Image;l.addEventListener("load",(function(){t[e.tilesets[o].image]=l,a++,a==r&&c.splitTiles(e,t,n,i,s)})),l.addEventListener("error",(function(){s(new Error(`Failed to load asset: ${n}`))})),l.src=e.tilesets[o].image}}static splitTiles(e,t,n,i,s){let r=[],a=e.tilesets.length;for(let n=0;n<a;n++)r.push(t[e.tilesets[n].image]);let o=[];for(let t=0;t<r.length;t++){let n=r[t].width/e.tilewidth,i=r[t].height/e.tileheight;for(let s=0;s<i;s++)for(let i=0;i<n;i++){let n=document.createElement("canvas"),a=n.getContext("2d");a.width=e.tilewidth,a.height=e.tileheight;let l=i*e.tilewidth,d=s*e.tileheight;a.drawImage(r[t],-l,-d),o.push(n)}}c.predraw(e,t,n,r,o,i,s)}static predraw(e,t,n,i,s,r,a){let o=document.createElement("canvas");o.width=e.width*e.tilewidth,o.height=e.height*e.tileheight;let l=o.getContext("2d");for(let t=0;t<e.layers.length;t++){let n=0,i=0;if("tilelayer"==e.layers[t].type)for(let r=0;r<e.layers[t].data.length;r++){if(r%e.width==0&&0!=r&&(i+=e.tileheight,n=0),0!=e.layers[t].data[r]){let a=s[e.layers[t].data[r]];l.drawImage(a,n,i)}n+=e.tilewidth}}let d=new Image;d.addEventListener("load",(function(){let s=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,d),gl.bindTexture(gl.TEXTURE_2D,null),d.textureID=s,t[n]={data:e,tilesets:i,image:d},r()})),d.addEventListener("error",(function(){a(new Error(`Failed to load asset: ${n}`))})),d.src=o.toDataURL("image/png")}}class h{constructor(){this.queue=[],this.cache={},this.loaderTypes={png:a,jpg:a,jpeg:a,json:o,tiled:c,glsl:l,vert:l,frag:l,mp3:d,wav:d,ogg:d}}get(e){return this.cache[e]}add(e,t){if(Array.isArray(e))for(let n of e)this.queue.push(this.getLoadFunction(n,t));else this.queue.push(this.getLoadFunction(e,t))}load(e,t){if(Array.isArray(e)){let n=[];for(let i of e)n.push(this.getLoaderFunction(i,t));return Promise.all(n)}return this.getLoadFunction(e,t)}loadAssets(){return Promise.all(this.queue)}unload(e,t){this.loaderTypes[this.getType(e,t)].unload(e,this.cache)}empty(){this.queue=[]}clear(){this.queue=[];for(let e of Object.keys(this.cache))this.loaderTypes[this.getType(e)].unload(e,this.cache)}registerType(e,t){this.loaderTypes[e]?console.error(`${e} already a registed asset type!`):this.loaderTypes[e]=t}getLoadFunction(e,t){let n=this.getType(e,t);if(this.loaderTypes.hasOwnProperty(n))return this.loaderTypes[n].load(e,this.cache);throw new Error(`Unknown asset type: ${n}`)}getType(e,t){if(t)return t;{let t=e.split(".");return t[t.length-1]}}}Object.freeze({TEXTURE:"png",JSON:"json",SHADER:"glsl",AUDIO:"mp3",TILEDMAP:"tiled"});class u{constructor(){this.active=!1,this.FPS=60,this.MPF=1e3/this.FPS,this.lastTime=0,this.lagTime=0,this.currentTime=0,this.elapsedTime=0}async create(){}render(){}update(){}dispose(){}static async setScreen(e){null!=u.currentScreen&&(u.currentScreen.active=!1),u.currentScreen=e,e.previousTime=performance.now(),e.active=!0,await e.create(),requestAnimationFrame(e.renderLoop.bind(e))}renderGUI(e){try{document.getElementById("skylark-gui").innerHTML=e}catch{throw new Error('Element with id: "skylark-gui" not found!')}}renderLoop(){if(this.active){for(requestAnimationFrame(this.renderLoop.bind(this)),this.currentTime=performance.now(),this.elapsedTime=this.currentTime-this.lastTime,this.lastTime=this.currentTime,this.lagTime+=this.elapsedTime;this.lagTime>=this.MPF&&this.active;)this.update(),this.lagTime-=this.MPF;this.render()}else this.dispose()}}u.currentScreen=null;class g{static on(e,t){g.events[e]=t,window.addEventListener(e,t)}static remove(e,t){delete g.events[e],window.removeEventListener(e,t)}static emit(e){g.events[e]()}static isPortrait(){return window.innerHeight>window.innerWidth}static isLandscape(){return window.innerWidth>window.innerHeight}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static toggleFullscreen(){document.fullscreenEnabled&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.body.requestFullscreen())}static togglePointerLock(){document.pointerLockElement?document.exitPointerLock&&document.exitPointerLock():document.body.requestPointerLock()}}g.events={};const p=new WebSocket("ws://localhost:3000");p.onopen=()=>{},p.onmessage=e=>{switch((e=JSON.parse(e.data)).type){case"status":document.getElementById("status").innerText=e.message,e.login&&setTimeout(()=>{m.navigate("/game")},2500)}},p.onerror=e=>{e&&console.log(e)},p.onclose=()=>{m.navigate("/"),window.location.reload()};let m=new class{constructor(e){this._routes=e,this._parsedRoutes=this._parseRoutes(),this._useHashRouting=!1}on(e,t){this._routes[e]=t,this._parsedRoutes=this._parseRoutes()}setRouteNotFound(e){this._routes.ERROR_404=e}navigate(e){window.history.pushState({},e,window.location.origin+e),this._matchUrlToRoute(e)}listen(e=!1){this._useHashRouting=e,this._useHashRouting?window.addEventListener("hashchange",()=>{this._matchUrlToRoute(this._getCurrentUrl())}):window.addEventListener("popstate",()=>{this._matchUrlToRoute(this._getCurrentUrl())}),this._matchUrlToRoute(this._getCurrentUrl())}async _renderView(e,t={}){e._params=t,await e.load(t),e._element.innerHTML=await e.render(t),await e.didLoad(t)}_getCurrentUrl(){const e=(this._useHashRouting?window.location.hash.slice(1)||"/":window.location.pathname||"/").toLowerCase();return e.endsWith("/")&&e.length>1?e.slice(0,-1):e}_parseRoutes(){return Object.keys(this._routes).sort((e,t)=>t.length-e.length).map(e=>({url:new RegExp("^"+e.replace(/:[^\s/]+/g,"([\\w-]+)")+"$"),view:this._routes[e],routepath:e}))}_getUrlParameters(e,t){const n={},i=e.routepath.split("/");let s=1;for(let e of i)e.startsWith(":")&&(n[e.substring(1)]=t[s],s++);return n}_matchUrlToRoute(e){let t=null;for(let n of this._parsedRoutes)if(t=e.match(n.url),t){const e=this._getUrlParameters(n,t);return void this._renderView(this._routes[n.routepath],e)}if(!t){const t=this._routes.ERROR_404;if(!t)return void document.write(`Error 404: ${e} not found!`);this._renderView(t)}}}({"/":new class extends t{load(){super.addStyle("\n            html,\n            body{\n                overflow: hidden;\n                width: 100%;\n                height: 100%;\n                background-color: black;\n            }\n\n            form{\n                display: flex;\n                flex-direction: column;\n                width: 50%;\n                margin: auto;\n                height: 50%;\n                position: absolute;\n                top: 45%;\n                left: 25%;\n                color: white;\n            }\n\n            form *{\n                background-color: transparent;\n                height: 10%;\n                color: white;\n            }\n\n            #status{\n                width: 100%;\n                height: auto;\n            }\n\n            #background{\n                width: 100%;\n                height: 10%;\n                margin: auto;\n            }\n        ")}render(){return'\n            <img src="assets/logo.png" id="background">\n            <form id="login">\n                <input id="email" placeholder="Email" />\n                <input id="password" type="password" placeholder="Password" />\n                <button type="submit">Connect</button>\n                <h2 id="status"></h2>\n            </form>\n        '}didLoad(){document.getElementById("login").onsubmit=e=>{var t;e.preventDefault(),t={type:"connect",email:document.getElementById("email").value,password:document.getElementById("password").value},p.send(JSON.stringify(t))}}},"/game":new class extends t{load(){super.addStyle("\n            html,\n            body{\n                overflow: hidden;\n                margin: 0px;\n                padding: 0px;\n            }\n        ")}render(){return""}didLoad(){u.setScreen(new w)}}});m.listen();class w extends u{constructor(){super()}async create(){this.display=new s(window.innerWidth,window.innerHeight),this.display.create(),this.loader=new h,g.on("resize",()=>{this.display.resize(window.innerWidth,window.innerHeight)}),await this.loader.loadAssets()}update(){}render(){this.display.clear()}dispose(){}}}();